---
title: sockjs-node:info 解决方案
date: 2022-03-03 11:09:40
permalink: /pages/8122c6/
categories:
  - 前端技术
tags:
  - Web开发
  - Vue.js
---

# vue/cle3项目运行报错sockjs-node/info解决方案

## 一. 复现

继上次将 vue 项目脚手架工具从 vue-cli2.x 升级到 vue-cli3.x 后，除了环境、配置问题外，在运行时出现了一些个新的问题。启动项目后，在内网非本机运行项目时，控制台报错如下：

```shell script
get http://localhost:8080/sockjs-node/info?t=1462183700002 net::ERR_CONNECTION_REFUSED
[WDS] Disconnected!
get http://localhost:8080/sockjs-node/info?t=1462183700002 net::ERR_CONNECTION_REFUSED
[WDS] Disconnected!
get http://localhost:8080/sockjs-node/info?t=1462183700002 net::ERR_CONNECTION_REFUSED
[WDS] Disconnected!
...
```

`webpack.config.js` 的目前配置如下：

```js
const path = require('path');
const resolve = dir => path.resolve(__dirname, dir);
const env = process.env.NODE_ENV;

module.exports = {
  // 基本路径配置，解决打包路径问题
  publicPath: './',

  // 配置less
  css: {
    loaderOptions: {
      css: {},
      postcss: {
        plugins: [
          require('postcss-px2rem')({
            remUnit: 37.5
          })
        ]
      }
    }
  },

  configureWebpack: (config) => {
    // 如果不是开发环境
    if (env !== 'development') {

    }

    // 路径
    config.resolve = {
      extensions: ['.js', '.vue', '.json'],
      alias: {
        'vue$': 'vue/dist/vue.esm.js',
        '@': resolve('src'),
      }
    }
  },

  chainWebpack: config => {
    // 添加别名
    config.resolve.alias
      .set('@', resolve('src'))
      .set('assets', resolve('src/assets'))
      .set('static', resolve('src/static'));
  }
}
```

## 二. 报错分析

首先，sockjs-node 是何方神圣？不难查出，sockjs-node 是一个 JavaScript 库，提供跨浏览器 JavaScript 的 API，创建了一个低延迟、全双工的浏览器和 web 服务器之间通信通道。那么在各端表现为：

- 服务端：sockjs-node（[https://github.com/sockjs/sockjs-node](https://github.com/sockjs/sockjs-node)）
- 客户端：sockjs-clien（[https://github.com/sockjs/sockjs-client](https://github.com/sockjs/sockjs-client)）

vue-cli3.x 的启动方式是 `npm run serve`，我们没有用到该 sockjs-node 功能，但启动时会默认连续发请求调用本地接口。因此我们要做的就是移除掉它。那么如何移除？

## 三. 解决方案

### 3.1 注释法

顾名思义，找到依赖包中的源码，将其注释：

1. 进入路径 `/node_modules/sockjs-client/dist/sockjs.js`
2. 代码 1605 行注释掉：

```js
try {
  // self.xhr.send(payload);  //本行注释
} catch (e) {
  self.emit('finish', 0, '');
  self._cleanup(false);
}
```

3. 重启项目

### 3.2 配置 vue.config

vue.config.js 中的 module.exports 中添加如下，然后重启：

```js
devServer: {
  proxy: 'http://localhost:8080',
  public: '192.168.xxx.xxx:8080'  // 本地ip
}
```

以上。
