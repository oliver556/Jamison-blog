<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>rollup 输出的 6 种格式 | Jamey&#39;s</title>
    <meta name="generator" content="VuePress 1.8.0">
    <link rel="stylesheet" href="//at.alicdn.com/t/font_3114978_qe0b39no76.css">
    <link rel="icon" href="/common/avatar.jpg">
    <link rel="stylesheet" href="https://at.alicdn.com/t/font_3077305_pt8umhrn4k9.css">
    <meta name="description" content="web前端技术博客，专注web">
    <meta name="keywords" content="前端博客,个人技术博客,前端,前端开发,前端框架,web前端,前端面试题,技术文档,学习,面试,JavaScript,js,ES6,TypeScript,vue,python,css3,html5,Node,git,github,markdown">
    <meta name="theme-color" content="#11a8cd">
    <meta name="referrer" content="no-referrer-when-downgrade">
    
    <link rel="preload" href="/assets/css/0.styles.958aac5a.css" as="style"><link rel="preload" href="/assets/js/app.8146073e.js" as="script"><link rel="preload" href="/assets/js/2.53e9b62d.js" as="script"><link rel="preload" href="/assets/js/179.43e3826f.js" as="script"><link rel="preload" href="/assets/js/4.49cfce35.js" as="script"><link rel="prefetch" href="/assets/js/10.769b9eed.js"><link rel="prefetch" href="/assets/js/100.3d61e469.js"><link rel="prefetch" href="/assets/js/101.b9bb39a6.js"><link rel="prefetch" href="/assets/js/102.a11ccded.js"><link rel="prefetch" href="/assets/js/103.7c274fa8.js"><link rel="prefetch" href="/assets/js/104.650aedb6.js"><link rel="prefetch" href="/assets/js/105.a4cbea5b.js"><link rel="prefetch" href="/assets/js/106.e1928a0a.js"><link rel="prefetch" href="/assets/js/107.4a2e0802.js"><link rel="prefetch" href="/assets/js/108.8bcc50d9.js"><link rel="prefetch" href="/assets/js/109.b9159c7d.js"><link rel="prefetch" href="/assets/js/11.e591b5d9.js"><link rel="prefetch" href="/assets/js/110.4cec05a6.js"><link rel="prefetch" href="/assets/js/111.f32d4d03.js"><link rel="prefetch" href="/assets/js/112.15b9ffde.js"><link rel="prefetch" href="/assets/js/113.c9ff09e2.js"><link rel="prefetch" href="/assets/js/114.a8cbe931.js"><link rel="prefetch" href="/assets/js/115.6dde9ccd.js"><link rel="prefetch" href="/assets/js/116.6563faac.js"><link rel="prefetch" href="/assets/js/117.5ab0c13e.js"><link rel="prefetch" href="/assets/js/118.8a978230.js"><link rel="prefetch" href="/assets/js/119.9118f13b.js"><link rel="prefetch" href="/assets/js/12.041edd88.js"><link rel="prefetch" href="/assets/js/120.63dec872.js"><link rel="prefetch" href="/assets/js/121.7012d8ce.js"><link rel="prefetch" href="/assets/js/122.607d43c0.js"><link rel="prefetch" href="/assets/js/123.a2d70b4b.js"><link rel="prefetch" href="/assets/js/124.857e3274.js"><link rel="prefetch" href="/assets/js/125.bd2f7f90.js"><link rel="prefetch" href="/assets/js/126.b18b6a43.js"><link rel="prefetch" href="/assets/js/127.406f6873.js"><link rel="prefetch" href="/assets/js/128.2868ec7b.js"><link rel="prefetch" href="/assets/js/129.a79599f8.js"><link rel="prefetch" href="/assets/js/13.33158654.js"><link rel="prefetch" href="/assets/js/130.885a120a.js"><link rel="prefetch" href="/assets/js/131.17e16215.js"><link rel="prefetch" href="/assets/js/132.7e527a70.js"><link rel="prefetch" href="/assets/js/133.0e272fa0.js"><link rel="prefetch" href="/assets/js/134.eb2f3594.js"><link rel="prefetch" href="/assets/js/135.a319e218.js"><link rel="prefetch" href="/assets/js/136.a8e02c63.js"><link rel="prefetch" href="/assets/js/137.6ad77c20.js"><link rel="prefetch" href="/assets/js/138.cf5afaf2.js"><link rel="prefetch" href="/assets/js/139.33d99d5a.js"><link rel="prefetch" href="/assets/js/14.e5eaf310.js"><link rel="prefetch" href="/assets/js/140.563c3c12.js"><link rel="prefetch" href="/assets/js/141.e6db04c8.js"><link rel="prefetch" href="/assets/js/142.51941014.js"><link rel="prefetch" href="/assets/js/143.3cd454d5.js"><link rel="prefetch" href="/assets/js/144.05ffe1a0.js"><link rel="prefetch" href="/assets/js/145.09481abe.js"><link rel="prefetch" href="/assets/js/146.b579d331.js"><link rel="prefetch" href="/assets/js/147.79b44127.js"><link rel="prefetch" href="/assets/js/148.b2266540.js"><link rel="prefetch" href="/assets/js/149.5ac78ade.js"><link rel="prefetch" href="/assets/js/15.178bdffd.js"><link rel="prefetch" href="/assets/js/150.5979cddd.js"><link rel="prefetch" href="/assets/js/151.32d3a399.js"><link rel="prefetch" href="/assets/js/152.187f5cf2.js"><link rel="prefetch" href="/assets/js/153.f84d9bb2.js"><link rel="prefetch" href="/assets/js/154.0e600577.js"><link rel="prefetch" href="/assets/js/155.330a651d.js"><link rel="prefetch" href="/assets/js/156.d8c7f098.js"><link rel="prefetch" href="/assets/js/157.81a4e391.js"><link rel="prefetch" href="/assets/js/158.9cf8981f.js"><link rel="prefetch" href="/assets/js/159.efb4fa11.js"><link rel="prefetch" href="/assets/js/16.a6aca1d4.js"><link rel="prefetch" href="/assets/js/160.eacf3c42.js"><link rel="prefetch" href="/assets/js/161.83b46a8e.js"><link rel="prefetch" href="/assets/js/162.237da82b.js"><link rel="prefetch" href="/assets/js/163.e054e907.js"><link rel="prefetch" href="/assets/js/164.43fdbc32.js"><link rel="prefetch" href="/assets/js/165.6a077a76.js"><link rel="prefetch" href="/assets/js/166.95d6286b.js"><link rel="prefetch" href="/assets/js/167.4526921c.js"><link rel="prefetch" href="/assets/js/168.16709438.js"><link rel="prefetch" href="/assets/js/169.febd5060.js"><link rel="prefetch" href="/assets/js/17.93b1dbc2.js"><link rel="prefetch" href="/assets/js/170.ab27a31a.js"><link rel="prefetch" href="/assets/js/171.fb55a1d0.js"><link rel="prefetch" href="/assets/js/172.fd29ba62.js"><link rel="prefetch" href="/assets/js/173.faafef04.js"><link rel="prefetch" href="/assets/js/174.1127a8e6.js"><link rel="prefetch" href="/assets/js/175.4ec5272d.js"><link rel="prefetch" href="/assets/js/176.4540f582.js"><link rel="prefetch" href="/assets/js/177.1f2fb5e8.js"><link rel="prefetch" href="/assets/js/178.a82671a0.js"><link rel="prefetch" href="/assets/js/18.75d331c3.js"><link rel="prefetch" href="/assets/js/180.1a6a16b6.js"><link rel="prefetch" href="/assets/js/181.12675e08.js"><link rel="prefetch" href="/assets/js/182.7e40c7eb.js"><link rel="prefetch" href="/assets/js/183.f7f67380.js"><link rel="prefetch" href="/assets/js/184.510e39e8.js"><link rel="prefetch" href="/assets/js/185.f4d2d9bc.js"><link rel="prefetch" href="/assets/js/186.f4cff53b.js"><link rel="prefetch" href="/assets/js/187.c1eaebfa.js"><link rel="prefetch" href="/assets/js/188.d8385943.js"><link rel="prefetch" href="/assets/js/189.9adeab37.js"><link rel="prefetch" href="/assets/js/19.157b6ad3.js"><link rel="prefetch" href="/assets/js/190.92f0f375.js"><link rel="prefetch" href="/assets/js/191.db00510b.js"><link rel="prefetch" href="/assets/js/192.110fe12f.js"><link rel="prefetch" href="/assets/js/193.1252ed99.js"><link rel="prefetch" href="/assets/js/194.defe31d1.js"><link rel="prefetch" href="/assets/js/195.b0f650e2.js"><link rel="prefetch" href="/assets/js/196.693c7cf4.js"><link rel="prefetch" href="/assets/js/197.d582570d.js"><link rel="prefetch" href="/assets/js/198.829b95fd.js"><link rel="prefetch" href="/assets/js/199.35d24744.js"><link rel="prefetch" href="/assets/js/20.0fc06484.js"><link rel="prefetch" href="/assets/js/200.2d133918.js"><link rel="prefetch" href="/assets/js/201.66350975.js"><link rel="prefetch" href="/assets/js/202.9f4a3762.js"><link rel="prefetch" href="/assets/js/203.ce448386.js"><link rel="prefetch" href="/assets/js/204.1b6af643.js"><link rel="prefetch" href="/assets/js/205.5e4eda82.js"><link rel="prefetch" href="/assets/js/206.587a8cd6.js"><link rel="prefetch" href="/assets/js/207.825e1fa6.js"><link rel="prefetch" href="/assets/js/208.793c65a5.js"><link rel="prefetch" href="/assets/js/209.15b38f86.js"><link rel="prefetch" href="/assets/js/21.53324fcb.js"><link rel="prefetch" href="/assets/js/210.de8a820b.js"><link rel="prefetch" href="/assets/js/211.7ccc49db.js"><link rel="prefetch" href="/assets/js/212.2157902c.js"><link rel="prefetch" href="/assets/js/213.d8ea0b1c.js"><link rel="prefetch" href="/assets/js/214.6c4f1e9f.js"><link rel="prefetch" href="/assets/js/215.a9969330.js"><link rel="prefetch" href="/assets/js/216.177fc220.js"><link rel="prefetch" href="/assets/js/217.60577727.js"><link rel="prefetch" href="/assets/js/218.a0abb991.js"><link rel="prefetch" href="/assets/js/219.14c9586f.js"><link rel="prefetch" href="/assets/js/22.44066032.js"><link rel="prefetch" href="/assets/js/220.616356af.js"><link rel="prefetch" href="/assets/js/221.6a657001.js"><link rel="prefetch" href="/assets/js/222.9dc4f54f.js"><link rel="prefetch" href="/assets/js/223.7d36005f.js"><link rel="prefetch" href="/assets/js/224.fc60f907.js"><link rel="prefetch" href="/assets/js/225.ba986742.js"><link rel="prefetch" href="/assets/js/226.2b5236e8.js"><link rel="prefetch" href="/assets/js/227.77a6e7f7.js"><link rel="prefetch" href="/assets/js/228.ae8efe1a.js"><link rel="prefetch" href="/assets/js/229.2e41e1e1.js"><link rel="prefetch" href="/assets/js/23.e70f7198.js"><link rel="prefetch" href="/assets/js/230.8102459d.js"><link rel="prefetch" href="/assets/js/231.6605c3fb.js"><link rel="prefetch" href="/assets/js/232.3e8402db.js"><link rel="prefetch" href="/assets/js/233.c460748a.js"><link rel="prefetch" href="/assets/js/234.b385bf4f.js"><link rel="prefetch" href="/assets/js/235.d08ff245.js"><link rel="prefetch" href="/assets/js/236.5c323034.js"><link rel="prefetch" href="/assets/js/237.33075f0d.js"><link rel="prefetch" href="/assets/js/238.dbabc6d7.js"><link rel="prefetch" href="/assets/js/239.7a6da26b.js"><link rel="prefetch" href="/assets/js/24.28edad38.js"><link rel="prefetch" href="/assets/js/240.48188606.js"><link rel="prefetch" href="/assets/js/25.049f013f.js"><link rel="prefetch" href="/assets/js/26.4c11bec2.js"><link rel="prefetch" href="/assets/js/27.19413744.js"><link rel="prefetch" href="/assets/js/28.a561628a.js"><link rel="prefetch" href="/assets/js/29.c8d28c57.js"><link rel="prefetch" href="/assets/js/3.e04e8e9a.js"><link rel="prefetch" href="/assets/js/30.f26ec4ce.js"><link rel="prefetch" href="/assets/js/31.bde7a456.js"><link rel="prefetch" href="/assets/js/32.9d4b7a9e.js"><link rel="prefetch" href="/assets/js/33.84c7b6e6.js"><link rel="prefetch" href="/assets/js/34.07ea45a5.js"><link rel="prefetch" href="/assets/js/35.18dde361.js"><link rel="prefetch" href="/assets/js/36.20340ae0.js"><link rel="prefetch" href="/assets/js/37.0bd6bb12.js"><link rel="prefetch" href="/assets/js/38.91c9bac3.js"><link rel="prefetch" href="/assets/js/39.e5151051.js"><link rel="prefetch" href="/assets/js/40.bc2662b5.js"><link rel="prefetch" href="/assets/js/41.a5d94555.js"><link rel="prefetch" href="/assets/js/42.7bf4d18c.js"><link rel="prefetch" href="/assets/js/43.0e5d47ca.js"><link rel="prefetch" href="/assets/js/44.1d1b5c69.js"><link rel="prefetch" href="/assets/js/45.8cd55664.js"><link rel="prefetch" href="/assets/js/46.99e8beac.js"><link rel="prefetch" href="/assets/js/47.50380303.js"><link rel="prefetch" href="/assets/js/48.1334b1d3.js"><link rel="prefetch" href="/assets/js/49.66b704a6.js"><link rel="prefetch" href="/assets/js/5.4fa51e86.js"><link rel="prefetch" href="/assets/js/50.5ec5cabc.js"><link rel="prefetch" href="/assets/js/51.cd50f5d2.js"><link rel="prefetch" href="/assets/js/52.ef8227ee.js"><link rel="prefetch" href="/assets/js/53.805ec9f3.js"><link rel="prefetch" href="/assets/js/54.25e3cfa4.js"><link rel="prefetch" href="/assets/js/55.ef020600.js"><link rel="prefetch" href="/assets/js/56.8d16cfca.js"><link rel="prefetch" href="/assets/js/57.bdd7ba79.js"><link rel="prefetch" href="/assets/js/58.e6b9b86e.js"><link rel="prefetch" href="/assets/js/59.1a952f6f.js"><link rel="prefetch" href="/assets/js/6.d4d47784.js"><link rel="prefetch" href="/assets/js/60.e45872f8.js"><link rel="prefetch" href="/assets/js/61.b6754a13.js"><link rel="prefetch" href="/assets/js/62.3deede21.js"><link rel="prefetch" href="/assets/js/63.2e787d24.js"><link rel="prefetch" href="/assets/js/64.74bcfe4d.js"><link rel="prefetch" href="/assets/js/65.e09bfce6.js"><link rel="prefetch" href="/assets/js/66.4bb59d35.js"><link rel="prefetch" href="/assets/js/67.e055f87a.js"><link rel="prefetch" href="/assets/js/68.50ce7031.js"><link rel="prefetch" href="/assets/js/69.4f3d070a.js"><link rel="prefetch" href="/assets/js/7.adafd225.js"><link rel="prefetch" href="/assets/js/70.db5efa39.js"><link rel="prefetch" href="/assets/js/71.c0fc0c7a.js"><link rel="prefetch" href="/assets/js/72.f9e2fec5.js"><link rel="prefetch" href="/assets/js/73.b4265543.js"><link rel="prefetch" href="/assets/js/74.53c06c9a.js"><link rel="prefetch" href="/assets/js/75.56b0192f.js"><link rel="prefetch" href="/assets/js/76.1b2c28f5.js"><link rel="prefetch" href="/assets/js/77.76951f00.js"><link rel="prefetch" href="/assets/js/78.12467512.js"><link rel="prefetch" href="/assets/js/79.920d7a32.js"><link rel="prefetch" href="/assets/js/8.e9c1fc77.js"><link rel="prefetch" href="/assets/js/80.096fc605.js"><link rel="prefetch" href="/assets/js/81.2d15ceec.js"><link rel="prefetch" href="/assets/js/82.f6589a2c.js"><link rel="prefetch" href="/assets/js/83.df1058c6.js"><link rel="prefetch" href="/assets/js/84.23f44791.js"><link rel="prefetch" href="/assets/js/85.3bfe5699.js"><link rel="prefetch" href="/assets/js/86.399dfc97.js"><link rel="prefetch" href="/assets/js/87.a924e401.js"><link rel="prefetch" href="/assets/js/88.08ce7ee8.js"><link rel="prefetch" href="/assets/js/89.f5918d63.js"><link rel="prefetch" href="/assets/js/9.6f856bc0.js"><link rel="prefetch" href="/assets/js/90.88af4054.js"><link rel="prefetch" href="/assets/js/91.1b3fbc53.js"><link rel="prefetch" href="/assets/js/92.8177c6d9.js"><link rel="prefetch" href="/assets/js/93.52710f7f.js"><link rel="prefetch" href="/assets/js/94.02f77878.js"><link rel="prefetch" href="/assets/js/95.ff80e3bf.js"><link rel="prefetch" href="/assets/js/96.e272b810.js"><link rel="prefetch" href="/assets/js/97.c203eb54.js"><link rel="prefetch" href="/assets/js/98.b02d35be.js"><link rel="prefetch" href="/assets/js/99.135710a8.js">
    <link rel="stylesheet" href="/assets/css/0.styles.958aac5a.css">
  </head>
  <body class="theme-mode-light">
    <div id="app" data-server-rendered="true"><div class="theme-container sidebar-open have-rightmenu"><header class="navbar blur"><div title="目录" class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><img src="/common/avatar.jpg" alt="Jamey's" class="logo"> <span class="site-name can-hide">Jamey's</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/" class="nav-link">首页</a></div><div class="nav-item"><a href="/navigation/" class="nav-link">导航站</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="前端" class="dropdown-title"><a href="/web/" class="link-title">前端</a> <span class="title" style="display:none;">前端</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>学习专栏</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/note/html/" class="nav-link">《HTML》笔记</a></li><li class="dropdown-subitem"><a href="/note/css/" class="nav-link">《CSS》笔记</a></li><li class="dropdown-subitem"><a href="/note/javascript/" class="nav-link">《JavaScript》笔记</a></li><li class="dropdown-subitem"><a href="/note/vue/" class="nav-link">《Vue》笔记</a></li><li class="dropdown-subitem"><a href="/note/git/" class="nav-link">《Git》笔记</a></li><li class="dropdown-subitem"><a href="/note/specification/" class="nav-link">《规范》笔记</a></li><li class="dropdown-subitem"><a href="/note/softSkill/" class="nav-link">《软技能》笔记</a></li><li class="dropdown-subitem"><a href="/note/interview/" class="nav-link">《面试》笔记</a></li><li class="dropdown-subitem"><a href="/note/continuousDelivery/" class="nav-link">《持续集成&amp;交付&amp;部署》笔记</a></li></ul></li><li class="dropdown-item"><h4>踩坑专栏</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/note/element-ui/" class="nav-link">《Element-UI 实践系列》笔记</a></li><li class="dropdown-subitem"><a href="/note/mobile/" class="nav-link">《移动端 实践系列》笔记</a></li><li class="dropdown-subitem"><a href="/note/complex/" class="nav-link">《综合》笔记</a></li></ul></li><li class="dropdown-item"><h4>配置专栏</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/node/environment/" class="nav-link">《环境系列》笔记</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="NAS" class="dropdown-title"><a href="/nas/" class="link-title">NAS</a> <span class="title" style="display:none;">NAS</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>极空间</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/note/nas/" class="nav-link">Docker</a></li></ul></li><li class="dropdown-item"><h4>影视</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/note/movie/" class="nav-link">movie</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="其他" class="dropdown-title"><a href="/comprehensive/" class="link-title">其他</a> <span class="title" style="display:none;">其他</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>编辑器笔记</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/note/idea/" class="nav-link">开发编辑器</a></li></ul></li><li class="dropdown-item"><h4>浏览器笔记</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/note/browser/" class="nav-link">Chrome</a></li></ul></li><li class="dropdown-item"><h4>Mac笔记</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/note/mac/" class="nav-link">Mac</a></li></ul></li><li class="dropdown-item"><h4>跨界学习</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/note/cross-border/" class="nav-link">运营</a></li></ul></li><li class="dropdown-item"><h4>破解合集</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/note/cracked/" class="nav-link">破解</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="索引" class="dropdown-title"><a href="/archives/" class="link-title">索引</a> <span class="title" style="display:none;">索引</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>本站</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/categories/" class="nav-link">分类</a></li><li class="dropdown-subitem"><a href="/tags/" class="nav-link">标签</a></li><li class="dropdown-subitem"><a href="/archives/" class="nav-link">归档</a></li></ul></li><li class="dropdown-item"><h4>我的</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/whell/web/" class="nav-link">收藏</a></li><li class="dropdown-subitem"><a href="/whell/book/" class="nav-link">书单</a></li><li class="dropdown-subitem"><a href="/about/" class="nav-link">关于</a></li></ul></li></ul></div></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <div class="sidebar-hover-trigger"></div> <aside class="sidebar" style="display:none;"><div class="blogger"><img src="/common/avatar.jpg"> <div class="blogger-info"><h3>Jamey</h3> <span></span></div></div> <nav class="nav-links"><div class="nav-item"><a href="/" class="nav-link">首页</a></div><div class="nav-item"><a href="/navigation/" class="nav-link">导航站</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="前端" class="dropdown-title"><a href="/web/" class="link-title">前端</a> <span class="title" style="display:none;">前端</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>学习专栏</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/note/html/" class="nav-link">《HTML》笔记</a></li><li class="dropdown-subitem"><a href="/note/css/" class="nav-link">《CSS》笔记</a></li><li class="dropdown-subitem"><a href="/note/javascript/" class="nav-link">《JavaScript》笔记</a></li><li class="dropdown-subitem"><a href="/note/vue/" class="nav-link">《Vue》笔记</a></li><li class="dropdown-subitem"><a href="/note/git/" class="nav-link">《Git》笔记</a></li><li class="dropdown-subitem"><a href="/note/specification/" class="nav-link">《规范》笔记</a></li><li class="dropdown-subitem"><a href="/note/softSkill/" class="nav-link">《软技能》笔记</a></li><li class="dropdown-subitem"><a href="/note/interview/" class="nav-link">《面试》笔记</a></li><li class="dropdown-subitem"><a href="/note/continuousDelivery/" class="nav-link">《持续集成&amp;交付&amp;部署》笔记</a></li></ul></li><li class="dropdown-item"><h4>踩坑专栏</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/note/element-ui/" class="nav-link">《Element-UI 实践系列》笔记</a></li><li class="dropdown-subitem"><a href="/note/mobile/" class="nav-link">《移动端 实践系列》笔记</a></li><li class="dropdown-subitem"><a href="/note/complex/" class="nav-link">《综合》笔记</a></li></ul></li><li class="dropdown-item"><h4>配置专栏</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/node/environment/" class="nav-link">《环境系列》笔记</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="NAS" class="dropdown-title"><a href="/nas/" class="link-title">NAS</a> <span class="title" style="display:none;">NAS</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>极空间</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/note/nas/" class="nav-link">Docker</a></li></ul></li><li class="dropdown-item"><h4>影视</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/note/movie/" class="nav-link">movie</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="其他" class="dropdown-title"><a href="/comprehensive/" class="link-title">其他</a> <span class="title" style="display:none;">其他</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>编辑器笔记</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/note/idea/" class="nav-link">开发编辑器</a></li></ul></li><li class="dropdown-item"><h4>浏览器笔记</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/note/browser/" class="nav-link">Chrome</a></li></ul></li><li class="dropdown-item"><h4>Mac笔记</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/note/mac/" class="nav-link">Mac</a></li></ul></li><li class="dropdown-item"><h4>跨界学习</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/note/cross-border/" class="nav-link">运营</a></li></ul></li><li class="dropdown-item"><h4>破解合集</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/note/cracked/" class="nav-link">破解</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="索引" class="dropdown-title"><a href="/archives/" class="link-title">索引</a> <span class="title" style="display:none;">索引</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>本站</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/categories/" class="nav-link">分类</a></li><li class="dropdown-subitem"><a href="/tags/" class="nav-link">标签</a></li><li class="dropdown-subitem"><a href="/archives/" class="nav-link">归档</a></li></ul></li><li class="dropdown-item"><h4>我的</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/whell/web/" class="nav-link">收藏</a></li><li class="dropdown-subitem"><a href="/whell/book/" class="nav-link">书单</a></li><li class="dropdown-subitem"><a href="/about/" class="nav-link">关于</a></li></ul></li></ul></div></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>深入系列</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>专题系列</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>underscore系列</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>ES6系列</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>模块化</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>正则表达式</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>单元测试</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>微前端</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>实用函数</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading open"><span>Rollup</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/pages/87263b/" aria-current="page" class="active sidebar-link">rollup 输出的 6 种格式</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header level2"><a href="/pages/87263b/#📖-学习本文" class="sidebar-link">📖. 学习本文</a></li><li class="sidebar-sub-header level2"><a href="/pages/87263b/#📖-为什么要学这个" class="sidebar-link">📖. 为什么要学这个？</a></li><li class="sidebar-sub-header level2"><a href="/pages/87263b/#📖-demo-与-示例构建" class="sidebar-link">📖. DEMO 与 示例构建</a></li><li class="sidebar-sub-header level2"><a href="/pages/87263b/#一-iife-自执行函数" class="sidebar-link">一. IIFE 自执行函数</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header level3"><a href="/pages/87263b/#_1-打包结果分析" class="sidebar-link">1. 打包结果分析</a></li><li class="sidebar-sub-header level3"><a href="/pages/87263b/#_2-如何运行" class="sidebar-link">2. 如何运行</a></li><li class="sidebar-sub-header level3"><a href="/pages/87263b/#_3-优缺点" class="sidebar-link">3. 优缺点</a></li></ul></li><li class="sidebar-sub-header level2"><a href="/pages/87263b/#二-commonjs" class="sidebar-link">二. CommonJS</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header level3"><a href="/pages/87263b/#_1-分析打包结果" class="sidebar-link">1. 分析打包结果</a></li><li class="sidebar-sub-header level3"><a href="/pages/87263b/#_2-如何运行-2" class="sidebar-link">2. 如何运行</a></li></ul></li><li class="sidebar-sub-header level2"><a href="/pages/87263b/#三-amd-和-requirejs" class="sidebar-link">三. AMD 和 requirejs !</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header level3"><a href="/pages/87263b/#_1-打包结果分析-2" class="sidebar-link">1. 打包结果分析</a></li><li class="sidebar-sub-header level3"><a href="/pages/87263b/#_2-如何运行-3" class="sidebar-link">2. 如何运行</a></li><li class="sidebar-sub-header level3"><a href="/pages/87263b/#_3-优缺点-2" class="sidebar-link">3. 优缺点</a></li></ul></li><li class="sidebar-sub-header level2"><a href="/pages/87263b/#四-umd-伟大的整合" class="sidebar-link">四. UMD 伟大的整合</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header level3"><a href="/pages/87263b/#_1-打包分析" class="sidebar-link">1. 打包分析</a></li><li class="sidebar-sub-header level3"><a href="/pages/87263b/#_2-如何运行-4" class="sidebar-link">2. 如何运行？</a></li><li class="sidebar-sub-header level3"><a href="/pages/87263b/#_3-优缺点-3" class="sidebar-link">3. 优缺点</a></li></ul></li><li class="sidebar-sub-header level2"><a href="/pages/87263b/#五-systemjs" class="sidebar-link">五. SystemJs</a></li><li class="sidebar-sub-header level2"><a href="/pages/87263b/#六-esm" class="sidebar-link">六. ESM</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header level3"><a href="/pages/87263b/#_1-打包分析-2" class="sidebar-link">1. 打包分析</a></li><li class="sidebar-sub-header level3"><a href="/pages/87263b/#_2-如何运行-5" class="sidebar-link">2. 如何运行</a></li></ul></li><li class="sidebar-sub-header level2"><a href="/pages/87263b/#🌟-总结" class="sidebar-link">🌟. 总结</a></li></ul></li><li><a href="/pages/277e73/" class="sidebar-link">13组 demo 理解 rollup 插件们</a></li></ul></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>解决方案</span> <span class="arrow right"></span></p> <!----></section></li></ul> </aside> <div><main class="page"><div class="theme-vdoing-wrapper "><div class="articleInfo-wrap" data-v-06225672><div class="articleInfo" data-v-06225672><ul class="breadcrumbs" data-v-06225672><li data-v-06225672><a href="/" title="首页" class="iconfont icon-home router-link-active" data-v-06225672></a></li> <li data-v-06225672><a href="/note/javascript/#《JavaScript》笔记" data-v-06225672>《JavaScript》笔记</a></li><li data-v-06225672><a href="/note/javascript/#Rollup" data-v-06225672>Rollup</a></li></ul> <div class="info" data-v-06225672><div title="作者" class="author iconfont icon-touxiang" data-v-06225672><a href="javascript:;" data-v-06225672>Jamey</a></div> <div title="创建时间" class="date iconfont icon-riqi" data-v-06225672><a href="javascript:;" data-v-06225672>2022-07-15</a></div> <!----></div></div></div> <!----> <div class="content-wrapper"><div class="right-menu-wrapper"><div class="right-menu-margin"><div class="right-menu-title">目录</div> <div class="right-menu-content"></div></div></div> <h1><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAB4AAAAeCAYAAAA7MK6iAAAAAXNSR0IArs4c6QAABKFJREFUSA3tVl1oFVcQnrMbrak3QUgkya1akpJYcrUtIqW1JvFBE9LiQ5v6JmJpolbMg32rVrhgoYK0QiMY6i9Y6EMaW5D+xFJaTYItIuK2Kr3+BJNwkxBj05sQY3b3nM6cs2dv9t7NT/vQJw/sndk5M/PNzJkzewGerP+pAmy+ON8lLzUJgA8ZYxYIYZmGYRnctDaWvJJAmTtfP1pvXsBCCPP8QFcCaRkZYACgDZFO4stNIcBCajEOlmmC9XpJ9bAGCaPaPmzPl32dvLSVu3BWCTQs0XQQ6g0DYgwLIoAZbBCdW/i+781o1VVlm/410mw4h06Y7bIPHNyWDyL4FHkX03Q8SrzNhZTZriieckWt7cL6MM85YcLpsi/7O9/iXFT6MswI0DmmpkSaJ0qLxFIm3+i1THHB3zmBH3PYx9CcykcLOeQVVa7QtdxTgQgEleX2AjHYfwA+2ddV77ruGoJUbhGDI09YSNXyMpUt5ylOzxgbUmtOp7NmbNt8v3arjTBfYELmLUV+M+nSawNNAUqpT3ClJWg5I3BLT+cGW/DXNGCa6tx1aakCGEigArTn4TDIPdrXXYKCZNrHLMCOEPvHBlLQ99s9eHB7EB6NTki73CVPQ2F5MSx/uRQixfmq7rK0wYD8w8E905bnPDfwoWs/rfv93NWN/ZfvwsLIU7A09gxECyISeGJkHAau98L97tuw7NXnoPyNF8FcYGLGKsOs0mN3OEyec9esGW/ZEl945dTP34wlR2FZVQWU1q0Cw8Tr7p+hgLLNL0FPxx/Q35mA8aEUrH6nCgwEl0tn7wUiZYJnNRh6DK4UH/k0lfyrsBKdPVv/AriGIQcEDQZ65LBAGe2Rzui9Ybjz7XUppz1/uKBbyVPGkN3ZAeC6hr0x7Nr38N5+EqkoOm17xpoqR9ohQF55ERSvr4Dkr3chNfC3DMzGJlNBElW8w9nsGQvhNGIzDkXzCg8cLK951xHsFBlTJspJNi3ZFIMF2AeDV3q8DNOB+YHi6QTrChDIWDBRi5U5f+ZMfJLu3ccrqxtdxk4SKH336LFxSmkqefwU5T8fhdSdQf9IVKD6aNiwI/hnmcAZ91isYMJIaCUCx9W098+LgruikeTqzqqxKPUwqJyCPJiyemVVZBOijDGjD38Os0jOiSPL1z3SPjXNANbiNPXAdzTfukjjuknNBbyz3nwgTd3AVFqUJ5hpHlq9MveLnWwttUfoygBmvVjuikxND3znrhsELnZk7k+OjIGxeNEkomyLVta0xxn+HZhjBc4YZ/AFjHjz9u3xRZl2BN4aq9nFwWh16IrQ1aHHEd3j1+4/dB9OtH4e29A2H1DyHQRmOSfQZ1Fy7MHBTGB6J/Djq6p3OxyO2cB+4Car7v/o3GXgfAkj23+x9ID1Teoamo/SXcbvSf2PX7Vc8DdCmE1vN9di+32P9/5YR3vLnhCVGUWBjEkr3yh4H8v9CzmsbdhzOKzsJKM90iFdaTMjRPhGVsakRvOaRidljo6H6G7j+ctrJpsP+4COhDIl0La2+FS4+5mlocBaXY5QnGZysIBYoeSsl5qQzrSj/cgNrfuEzlWBfwA+EjrZyWUvpAAAAABJRU5ErkJggg==">rollup 输出的 6 种格式<!----></h1> <!----> <div class="theme-vdoing-content content__default"><h1 id="rollup-输出的-6-种格式"><a href="#rollup-输出的-6-种格式" class="header-anchor">#</a> rollup 输出的 6 种格式</h1> <blockquote><p>之前找工作的时候因为在简历上写“熟练使用 rollup.js 进行构建”，但回答不出 rollup 能打包出哪几种格式，我差点被面试官鄙视。</p></blockquote> <blockquote><p>确实不应该！</p></blockquote> <blockquote><p>于是重新学习和梳理了一遍，和大家一起分享。</p></blockquote> <h2 id="📖-学习本文"><a href="#📖-学习本文" class="header-anchor">#</a> 📖. 学习本文</h2> <p>你将：</p> <ol><li>弄明白 rollup 输出的 6 种格式，了解它们之间的关系和使用场景。</li> <li>获得一份最简单的 <code>rollup.js</code> 打包 <code>demo</code> 一份。</li> <li>这份 <code>demo</code> 还为每隔打包结果准备了一个可执行 <code>demo of demo</code>。</li></ol> <h2 id="📖-为什么要学这个"><a href="#📖-为什么要学这个" class="header-anchor">#</a> 📖. 为什么要学这个？</h2> <p>伴随着 <code>vite.js</code> 越来越火，它也变成了工作生产和 <strong>面试问答</strong> 时被经常提及的问题。</p> <p>众所周知，<code>vite.js</code> 构建的核心是 <code>rollup.js</code>。</p> <p>那为什么在学习它们之前，有必要先学习 <code>js</code> 模块化规范？</p> <p>因为我们需要理解它们最终的产物是什么，是如何运作的。</p> <p>“崇拜魔法” 是编程学习者的大忌，“好奇心” 才是我们成长与进步的阶梯。</p> <p>让我们解开神秘的面纱，看看那些打包后的代码，都是些 “什么玩意儿”！</p> <h2 id="📖-demo-与-示例构建"><a href="#📖-demo-与-示例构建" class="header-anchor">#</a> 📖. DEMO 与 示例构建</h2> <blockquote><p>请配合 <code>demo</code> 食用，你会收获更多！</p></blockquote> <p>我为本文构建了一个简单的 <code>demo</code> 实例，源码就放在 <code>github</code> 上。</p> <p><code>demo</code> 地址：<a href="https://github.com/oliver556/rollup-demos/tree/master/js-modules" target="_blank" rel="noopener noreferrer">https://github.com/oliver556/rollup-demos/tree/master/js-modules<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <p><code>demo</code> 的代码结构如下：</p> <div class="language-tree line-numbers-mode"><pre class="language-text"><code>├── answer.js
├── index.js
├── out
├── package.json
├── rollup.config.js
└── yarn.lock
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><p>其中 <code>index.js</code> 和 <code>answer.js</code> 属于业务代码，是需要被打包的对象。在 <code>index.js</code> 中依赖了 <code>answer.js</code>。</p> <p>如下：</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">// answer.js</span>
<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token number">42</span><span class="token punctuation">;</span>

<span class="token comment">// index.js</span>
<span class="token keyword">import</span> answer <span class="token keyword">from</span> <span class="token string">&quot;./answer&quot;</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> repeat <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'lodash'</span><span class="token punctuation">;</span>

<span class="token comment">// 定义一个无用变量, 测试 tree-shaking</span>
<span class="token keyword">const</span> unusedVar <span class="token operator">=</span> <span class="token string">'May the 4th'</span><span class="token punctuation">;</span>

<span class="token keyword">export</span> <span class="token keyword">const</span> <span class="token function-variable function">printAnswer</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token comment">// 打印</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">the answer is </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>answer<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token comment">// 测试 lodash 的能力，打印42个1</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token function">repeat</span><span class="token punctuation">(</span><span class="token string">'1'</span><span class="token punctuation">,</span> answer<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br></div></div><p><code>rollup.config.js</code> 是 <code>rollup</code> 的配置文件，在此文件中我们分别指定其输出 <code>amd</code> , <code>cjs</code> , <code>esm</code> , <code>iife</code> , <code>umd</code> , <code>system</code> 六种格式的文件。</p> <p>输出的文件会被打包到 <code>out</code> 文件夹下。</p> <p>当我们执行 <code>yarn build</code> 或者 <code>npm build</code> 之后，会在 <code>out</code> 下产生如下格式的代码：</p> <div class="language-tree line-numbers-mode"><pre class="language-text"><code>├── out
│   ├── amd
│   │   └── bundle.js
│   ├── cjs
│   │   └── bundle.js
│   ├── ems
│   │   └── bundle.js
│   ├── iife
│   │   └── bundle.js
│   ├── system
│   │   └── bundle.js
│   └── umd
│       └── bundle.js
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br></div></div><p>为了弄清楚每种格式的 <code>bundle.js</code> 文件是如何运作的，我专门为它们订制添加了一些附属的小 <code>demo</code>。</p> <p>接下来，就让我们一种格式一种格式地学习和分析吧。</p> <h2 id="一-iife-自执行函数"><a href="#一-iife-自执行函数" class="header-anchor">#</a> 一. IIFE 自执行函数</h2> <blockquote><p>IIFE 的全称是 “immediately invoked function expression”。</p></blockquote> <h3 id="_1-打包结果分析"><a href="#_1-打包结果分析" class="header-anchor">#</a> 1. 打包结果分析</h3> <p>让我们先看看本 <code>demo</code> 的 <code>iife</code> 格式打出来的包长什么样。</p> <p><img src="https://cdn.staticaly.com/gh/oliver556/image-hosting@master/20220718/javascript_07-18_01.6frk6lpm79k0.webp" alt="javascript_07-18_01"></p> <p>对上述代码做一些简化：</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">var</span> Test <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">exports<span class="token punctuation">,</span> lodash</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token string">'use strict'</span><span class="token punctuation">;</span> <span class="token comment">// 自带严格模式，避免一些奇怪的兼容性问题</span>

  <span class="token comment">/**
   * 下面折行无用代码被 tree-shaking 掉了
   * const unusedVar = 'May the 4th'
   * */</span>

  <span class="token keyword">var</span> answer <span class="token operator">=</span> <span class="token number">42</span><span class="token punctuation">;</span> <span class="token comment">// 业务中被单一引用的模块，被直接抹平了</span>

  <span class="token keyword">const</span> <span class="token function-variable function">printAnswer</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">the answer is </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>answer<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>lodash<span class="token punctuation">.</span><span class="token function">repeat</span><span class="token punctuation">(</span><span class="token string">'1'</span><span class="token punctuation">,</span> answer<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>

  exports<span class="token punctuation">.</span>printAnswer <span class="token operator">=</span> printAnswer<span class="token punctuation">;</span> <span class="token comment">// 把要export的属性挂在到exports上</span>

  <span class="token keyword">return</span> exports<span class="token punctuation">;</span>

<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span> $<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// exports是第一个入参，依赖的jquery是第二个入参</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br></div></div><p><code>IIFE</code> 是前端模块化早期的产物，它的核心思路是:</p> <ol><li>构建一个匿名函数</li> <li>立刻执行这个匿名函数，对外部的依赖通过入参的形式传入</li> <li>返回该模块的输出</li></ol> <h3 id="_2-如何运行"><a href="#_2-如何运行" class="header-anchor">#</a> 2. 如何运行</h3> <p><code>IIFE</code> 的运行其实很容易，如果它没有其他依赖，只需要去引入文件，然后在 <code>window</code> 上取相应的变量即可。</p> <p>如：</p> <div class="language-html line-numbers-mode"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>http://cdn.bootcss.com/jquery/3.3.1/jquery.min.js<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token script"></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript"> 
  <span class="token comment">// jquery 就是典型的自执行函数模式，当你引入后，他就会挂在到 window.$ 上</span>
  window<span class="token punctuation">.</span>$ <span class="token comment">// 这样就能取到 jquery 了</span>
</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p>但是如果你像本 <code>demo</code> 中那样依赖了其他的模块，那你就必须保证以下两点才能正常运行：</p> <ol><li>此包所依赖的包，已在此包之前完成加载。</li> <li>前置依赖的包，和 <code>IIFE</code> 只执行入参的变量命名是一致的。</li></ol> <p>以本 <code>demo</code> 的 <code>IIFE</code> 构建结果为例：</p> <ol><li>它前置依赖了 <code>lodash</code>，因此需要在它加载之前完成 lodash 的加载。</li> <li>此 <code>IIFE</code> 的第二个入参是 <code>lodash</code>，作为前置条件，我们需要让 <code>window.lodash</code> 也指向 <code>lodash</code>。 因此，运行时，代码如下：</li></ol> <div class="language-html line-numbers-mode"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>head</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>https://cdn.bootcdn.net/ajax/libs/lodash.js/4.17.21/lodash.min.js<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token script"></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">window<span class="token punctuation">.</span>lodash <span class="token operator">=</span> window<span class="token punctuation">.</span>_</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>  
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>./bundle.js<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token script"></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>head</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>body</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">
    window<span class="token punctuation">.</span>Test<span class="token punctuation">.</span><span class="token function">printAnswer</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  </span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>body</span><span class="token punctuation">&gt;</span></span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><h3 id="_3-优缺点"><a href="#_3-优缺点" class="header-anchor">#</a> 3. 优缺点</h3> <ul><li>优点:
<ul><li>通过闭包营造了一个“私有”命名空间，防止影响全局，并防止被从外部修改私有变量。</li> <li>简单易懂</li> <li>对代码体积的影响不大</li></ul></li> <li>缺点：
<ul><li>输出的变量可能影响全局变量；引入依赖包时依赖全局变量。</li> <li>需要使用者自行维护 script 标签的加载顺序。</li></ul></li></ul> <p>优点就不细说了，缺点详细解释一下。</p> <p><strong>缺点一：输出的变量可能影响全局变量；引入依赖包时依赖全局变量。</strong></p> <p>前半句：<strong>输出的变量可能影响全局变量;</strong> 其实很好理解，以上面 <code>demo</code> 的输出为例： <code>window.Test</code> 就已经被影响了。这种明显的副作用在程序中其实是有隐患的。</p> <p>后半句：<strong>引入依赖包时依赖全局变量；</strong> 我们为了让 <code>demo</code> 正常运行，因此加了一行代码让 <code>window.lodash</code> 也指向 <code>lodash</code>，但它确实是太脆弱了。</p> <div class="language-html line-numbers-mode"><pre class="language-html"><code><span class="token comment">&lt;!-- 没有这一行，demo就无法正常运行 --&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">window<span class="token punctuation">.</span>lodash <span class="token operator">=</span> window<span class="token punctuation">.</span>_</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>你瞧，<code>IIFE</code> 的执行对环境的依赖是苛刻的，除非它完全不依赖外部包。（Jquery: 正是在下！）</p> <p>虽然 <code>IIFE</code> 的缺点很多，但并不妨碍它在 <code>Jquery</code> 时代极大地推动了 <code>web</code> 开发的进程，因为它确实解决了 <code>js</code> 本身存在的很多问题。</p> <p>那么？后续是否还有 <strong>更为优秀</strong> 的前端模块化方案问世呢？</p> <p>当然有，往下看吧。</p> <h2 id="二-commonjs"><a href="#二-commonjs" class="header-anchor">#</a> 二. CommonJS</h2> <h3 id="_1-分析打包结果"><a href="#_1-分析打包结果" class="header-anchor">#</a> 1. 分析打包结果</h3> <p>先看看 <code>CommonJs</code> 打包的结果:</p> <p><img src="https://cdn.staticaly.com/gh/oliver556/image-hosting@master/20220718/javascript_07-18_02.36xdievzk260.webp" alt="javascript_07-18_02"></p> <p>简化一下，就长这样了：</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token string">'use strict'</span><span class="token punctuation">;</span>

<span class="token keyword">var</span> lodash <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'lodash'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">var</span> answer <span class="token operator">=</span> <span class="token number">42</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> <span class="token function-variable function">printAnswer</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token comment">// 打印</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">the answer is </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>answer<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token comment">// 测试 lodash 的能力，打印42个1</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>lodash<span class="token punctuation">.</span><span class="token function">repeat</span><span class="token punctuation">(</span><span class="token string">'1'</span><span class="token punctuation">,</span> answer<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

exports<span class="token punctuation">.</span>printAnswer <span class="token operator">=</span> printAnswer<span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br></div></div><p>以上格式，就是 <code>CommonJS</code> 规范的写法。</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">// CommonJS 通过一个全局 require 方法进行模块的引入 </span>
<span class="token keyword">var</span> lodash <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'lodash'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// CommonJS 进行模块内方法输出的方式</span>
module<span class="token punctuation">.</span>exports<span class="token punctuation">.</span>printAnswer <span class="token operator">=</span> printAnswer<span class="token punctuation">;</span>

<span class="token comment">// 上面写法也等价于：</span>
exports<span class="token punctuation">.</span>printAnswer <span class="token operator">=</span> printAnswer<span class="token punctuation">;</span>
<span class="token comment">// 因为 exports 变量等价于 module.exports</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><p>为了解决 <code>node.js</code> 在模块化上的缺失， <strong>2009年10月</strong> <code>CommonJS</code> 规范首次被提出。</p> <p>注意这个关键词： <strong>node.js</strong>。</p> <p>是的，<code>CommonJS</code> 并不是在浏览器环境运行的规范，而是在 <code>node.js</code> 环境下运行的。</p> <h3 id="_2-如何运行-2"><a href="#_2-如何运行-2" class="header-anchor">#</a> 2. 如何运行</h3> <p>因此，我写了一个 <code>run.js</code> 脚本。 如下：</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">// run.js</span>
<span class="token keyword">const</span> Test <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'./bundle-by-lodash'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
Test<span class="token punctuation">.</span><span class="token function">printAnswer</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>然后，执行以下命令：</p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code><span class="token comment"># 执行脚本</span>
<span class="token function">node</span> ./out/cjs/run.js 
<span class="token comment"># 输出1： </span>
<span class="token operator">&gt;</span> the answer is <span class="token number">42</span>
<span class="token comment"># 输出2： </span>
<span class="token operator">&gt;</span> <span class="token number">111111111111111111111111111111111111111111</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><p>可以看出，<code>node.js</code> 环境是天然支持 <code>CommonJS</code> 的。</p> <p>##3 3. 优缺点</p> <ul><li>优点
<ol><li>完善的模块化方案，完美解决了 IIFE 的各种缺点。</li></ol></li> <li>缺点
<ol><li>不支持浏览器环境，因为这种同步的引入方式可能导致浏览器假死。</li></ol></li></ul> <p>因此，前端界迫切地需要一种能在浏览器环境完美运行，完善的模块化方案。</p> <h2 id="三-amd-和-requirejs"><a href="#三-amd-和-requirejs" class="header-anchor">#</a> 三. AMD 和 requirejs !</h2> <blockquote><p>AMD，YES!</p></blockquote> <p>2011年， <code>amdjs-api</code> 在业内被正式提出。</p> <h3 id="_1-打包结果分析-2"><a href="#_1-打包结果分析-2" class="header-anchor">#</a> 1. 打包结果分析</h3> <p>amd 格式的打包结果如下：</p> <p><img src="https://cdn.staticaly.com/gh/oliver556/image-hosting@master/20220718/javascript_07-18_03.6c8fyxl59k80.webp" alt="javascript_07-18_03"></p> <p>可以看到，核心内容是一个全局方法 <code>define</code> 。</p> <p><code>define</code> 方法有三个入参，分别是：</p> <ul><li><code>&quot;Test&quot;</code>, 模块名称</li> <li><code>[</code>exports<code>,</code> lodash<code>]</code> 分别表示模块的输出和外部依赖</li> <li>一个以 <code>exports</code> 和 <code>lodash</code> 作为入参的方法，代表模块的实际内容。</li></ul> <p>相比于 <code>IIFE</code> 和 <code>CommonJs</code> 而言，<code>AMD</code> 的写法无疑是复杂且别扭的。</p> <p>但它却实实在在是解决了 <code>IIFE 和</code> <code>CommonJS</code> 所面临的问题，对“浏览器里完善的 JS 模块方法” 提供了一套完善的方案。</p> <p>尤其是 <code>amd</code> 标准的实现方案：<code>requirejs</code>。</p> <p><code>requirejs</code> 所实现的 <code>AMD</code> 不仅解决了 <code>CommonJS</code> 在浏览器端的不适，通过异步的方式进行模块加载实现了不会导致假死的能力；更是完全弥补了 <code>IIFE</code> 存在的各类缺陷。</p> <p><code>requirejs</code> 在使用时，一般情况下是以下四步法：</p> <ol><li>在浏览器内引入 <code>require.js</code></li> <li>通过 <code>requirejs.config</code> 方法定义全局的依赖</li> <li>通过 <code>requirejs.define</code> 注册模块</li> <li>通过 <code>requirejs()</code> 完成模块引入。</li></ol> <h3 id="_2-如何运行-3"><a href="#_2-如何运行-3" class="header-anchor">#</a> 2. 如何运行</h3> <p>在 <code>out/amd</code> 打包目录下的 <code>index.html</code> 里，按如下方式编排代码：</p> <div class="language-html line-numbers-mode"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>head</span><span class="token punctuation">&gt;</span></span>
  <span class="token comment">&lt;!-- 1. 引入 require.js --&gt;</span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>./require.js<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token script"></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>

  <span class="token comment">&lt;!-- 2. 定义全局依赖 --&gt;</span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">
    window<span class="token punctuation">.</span>requirejs<span class="token punctuation">.</span><span class="token function">config</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
      <span class="token literal-property property">paths</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token string-property property">&quot;lodash&quot;</span><span class="token operator">:</span> <span class="token string">&quot;https://cdn.bootcdn.net/ajax/libs/lodash.js/4.17.21/lodash.min&quot;</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  </span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>

  <span class="token comment">&lt;!-- 3. 定义模块 --&gt;</span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>./bundle.js<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token script"></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>head</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>body</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">
    <span class="token comment">// 4. 开销模块</span>
    window<span class="token punctuation">.</span><span class="token function">requirejs</span><span class="token punctuation">(</span>
      <span class="token punctuation">[</span><span class="token string">'Test'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
      <span class="token keyword">function</span>   <span class="token punctuation">(</span><span class="token parameter">test</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        test<span class="token punctuation">.</span><span class="token function">printAnswer</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">)</span><span class="token punctuation">;</span>
  </span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>body</span><span class="token punctuation">&gt;</span></span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br></div></div><p>打开浏览器，我们可以正常地看到]控制台里被打印出来的 <code>42</code> 和 <code>42个1</code> 了。</p> <h3 id="_3-优缺点-2"><a href="#_3-优缺点-2" class="header-anchor">#</a> 3. 优缺点</h3> <ul><li>优点
<ol><li>解决了 <code>CommonJS</code> 的缺点</li> <li>解决了 <code>IIFE</code> 的缺点</li> <li>一套完备的浏览器里 <code>js</code> 文件模块化方案</li></ol></li> <li>缺点
<ol><li>代码组织形式别扭，可读性差</li></ol></li></ul> <p>但好在我们拥有了各类打包工具，浏览器内的代码可读性再差也并不影响我们写出可读性ok的代码。</p> <p>现在，我们拥有了<strong>面向 <code>node.js</code> 的 <code>CommonJs</code></strong> 和 <strong>面向浏览器的 <code>AMD</code></strong> 两套标准。</p> <p>如果我希望我写出的代码能同时被 <strong>浏览器</strong> 和 <strong>nodejs</strong> 识别，我应该怎么做呢？</p> <h2 id="四-umd-伟大的整合"><a href="#四-umd-伟大的整合" class="header-anchor">#</a> 四. UMD 伟大的整合</h2> <blockquote><p>它没有做什么突破性的创造，但它是集大成者。</p></blockquote> <h3 id="_1-打包分析"><a href="#_1-打包分析" class="header-anchor">#</a> 1. 打包分析</h3> <p><code>umd</code> 格式构建出来的代码的可读性进一步降低了。</p> <p>我相信任何正常人看到下面这段代码都会感到一阵头大：</p> <p><img src="https://cdn.staticaly.com/gh/oliver556/image-hosting@master/20220718/javascript_07-18_04.263jdfxpn30.webp" alt="javascript_07-18_04"></p> <p>是的，整整一大段代码，只是在处理兼容性问题，判断当前应该使用 <code>amd</code> 亦或是 <code>CommonJS</code>。</p> <p>因此 umd 的代码和实现不在此进行过多分析，它所做的无非便是让同一段代码兼容了 <code>amd</code> 和 <code>CommonJS</code>。</p> <h3 id="_2-如何运行-4"><a href="#_2-如何运行-4" class="header-anchor">#</a> 2. 如何运行？</h3> <ul><li>在浏览器端，它的运行方式和 <code>amd</code> 完全一致，可以完全参考 <code>3.2</code> 节的 <code>demo</code>。</li> <li>在 node.js 端，它则和 <code>CommonJS</code> 的运行方式完全一致，在此就不赘述了。</li></ul> <h3 id="_3-优缺点-3"><a href="#_3-优缺点-3" class="header-anchor">#</a> 3. 优缺点</h3> <ul><li>优点
<ul><li>抹平了一个包在 AMD 和 CommonJS 里的差异</li></ul></li> <li>缺点
<ul><li>会为了兼容产生大量不好理解的代码。（理解难度与包体积）</li></ul></li></ul> <p>虽然在社区的不断努力下，<code>CommonJS</code> 、 <code>AMD</code> 、 <code>UMD</code> 都给业界交出了自己的答卷。</p> <p>但很显然，它们都是不得已的选择。</p> <p>浏览器应该有自己的加载标准。</p> <p><code>ES6</code> 草案最终版里，虽然描述了模块应该如何被加载，但它没有 “加载程序的规范”。</p> <h2 id="五-systemjs"><a href="#五-systemjs" class="header-anchor">#</a> 五. SystemJs</h2> <p>因此 <code>WHATWG（Web Hypertext Application Technology Working Group）</code> 即网页超文本应用技术工作小组，提出了一套更有远见的规范：<a href="https://github.com/whatwg/loader" target="_blank" rel="noopener noreferrer">whatwg/loader<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>。</p> <p>也就是 <code>JavaScript Loader Standard</code>（JS 加载标准）。</p> <blockquote><p>本规范描述了从 JavaScript 宿主环境中加载 JavaScript 模块的行为。它还提供了用于拦截模块加载过程和自定义加载行为的 api。</p></blockquote> <p>基于此规范，<code>SystemJS</code> 诞生了。</p> <p><code>SystemJS</code> 是目前 <code>whatwg/loader</code> 规范的最佳实践者。</p> <p><img src="https://cdn.staticaly.com/gh/oliver556/image-hosting@master/20220718/javascript_07-18_05.5z2xhkkomew0.webp" alt="javascript_07-18_05"></p> <p>可以看出来，<code>system</code> 的打包结果其实和 <code>amd</code> 类似，提供了全局的对象 <code>System</code>，并提供了注册的方式和统一的写法。</p> <p>就单纯的从打包结果上，其实看不出它相比对 <code>AMD + require.js</code> 有什么优势，<strong>难道只是写法上存在差异?</strong></p> <p>并不止于此！</p> <p>相比于 <code>require.js</code>，<code>SystemJS</code> 的 <code>System.import('module/name')</code> 方式允许你更为 “懒” 地加载模块，这意味着你无需每次都加载一大堆的 <code>bundle</code>，用户只需要为他能看见的页面开销带宽。</p> <p>另外，正因为 <code>SystemJS</code> 是面向 <code>whatwg/loader</code> 规范实践的，因此它是面向未来的模块依赖方式。</p> <blockquote><p>抱歉，这个的 demo 我也没玩明白，就不误导大家了。希望有明白的大佬可以帮忙完善下demo。</p></blockquote> <h2 id="六-esm"><a href="#六-esm" class="header-anchor">#</a> 六. ESM</h2> <blockquote><p>ECMAScript modules, 也叫 ESM, Javascript 模块化官方标准格式。</p></blockquote> <h3 id="_1-打包分析-2"><a href="#_1-打包分析-2" class="header-anchor">#</a> 1. 打包分析</h3> <p>在 <code>ESM</code> 被提出来之前，JavaScript 一直没有真正意义上的模块（module）体系。</p> <p>它的规范是通过 <code>export</code> 命令显式指定输出的代码，再通过 <code>import</code> 命令输入。</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">// 导入模块</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> foo <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'bar'</span><span class="token punctuation">;</span>
<span class="token comment">// 导出命令</span>
<span class="token keyword">export</span> <span class="token punctuation">{</span> zap <span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>这也是我们日常开发中最为熟悉的写法。</p> <p>因此，<code>esm</code> 格式打出来的包，可读性确实非常棒:</p> <p><img src="https://cdn.staticaly.com/gh/oliver556/image-hosting@master/20220718/javascript_07-18_06.3cratjoe2t00.webp" alt="javascript_07-18_06"></p> <p>和阅读我们平时所写的业务代码完全没有区别。（<code>rollup</code> 依然没忘记做 <code>tree-shaking</code>）</p> <h3 id="_2-如何运行-5"><a href="#_2-如何运行-5" class="header-anchor">#</a> 2. 如何运行</h3> <blockquote><p>祝贺你，是这个时代的前端开发。</p></blockquote> <p>部分现代浏览器已经开始实装 <code>&lt;script type=&quot;module&gt;</code> 了，因此在浏览器上直接使用 <code>esm</code> 已成为现实。</p> <p>但运行起来扔需要做一些前置步骤。</p> <ol><li>在 js-modules 目录下起一个本地静态服务</li></ol> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code><span class="token comment"># 在js-modules目录下起一个本地静态服务</span>
<span class="token builtin class-name">cd</span> js-modules <span class="token operator">&amp;&amp;</span> http-server
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><ol start="2"><li>把 <code>esm/bundle.js</code> 文件的第一行修改为：</li></ol> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">import</span> repeat <span class="token keyword">from</span> <span class="token string">'../../node_modules/lodash-es/repeat.js'</span><span class="token punctuation">;</span>
<span class="token comment">// 因为默认的lodash并不是输出的 esm 格式，因此为了demo我们需要做一些特殊处理</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><ol start="3"><li>在浏览器打开页面(假设端口是8080)，则打开：<a href="http://127.0.0.1:8080/out/esm/index.html" target="_blank" rel="noopener noreferrer">http://127.0.0.1:8080/out/esm/index.html<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ol> <p>这样一来，代码就能成功运行，控制台就可以成功打印 <code>42</code> 和 <code>42个1</code> 了。</p> <h2 id="🌟-总结"><a href="#🌟-总结" class="header-anchor">#</a> 🌟. 总结</h2> <p><strong>分别适合在什么场景使用？</strong></p> <ul><li><code>IIFE</code>: 适合部分场景作为SDK进行使用，尤其是需要把自己挂到 <code>window</code> 上的场景。</li> <li><code>CommonJS</code>: 仅 node.js 使用的库。</li> <li><code>AMD</code>: 只需要在浏览器端使用的场景。</li> <li><code>UMD</code>: 既可能在浏览器端也可能在 node.js 里使用的场景。</li> <li><code>SystemJs</code>: 和 UMD 类似。目前较出名的 <code>Angular</code> 用的就是它。</li> <li><code>ESM</code>:
<ol><li>还会被引用、二次编译的场景（如组件库等）；</li> <li>浏览器调试场景如 <code>vite.js</code> 的开发时。</li> <li>对浏览器兼容性非常宽松的场景。</li></ol></li></ul></div></div> <!----> <div class="page-edit"><!----> <div class="tags"><a href="/tags/?tag=Rollup" title="标签">#Rollup</a></div> <div class="last-updated"><span class="prefix">上次更新:</span> <span class="time">2022/07/20, 15:39:52</span></div></div> <div class="page-nav-wapper"><div class="page-nav-centre-wrap"><a href="/pages/b56a5d/" class="page-nav-centre page-nav-centre-prev"><div class="tooltip">JavaScript 实现无限级递归树</div></a> <a href="/pages/277e73/" class="page-nav-centre page-nav-centre-next"><div class="tooltip">13组 demo 理解 rollup 插件们</div></a></div> <div class="page-nav"><p class="inner"><span class="prev">
        ←
        <a href="/pages/b56a5d/" class="prev">JavaScript 实现无限级递归树</a></span> <span class="next"><a href="/pages/277e73/">13组 demo 理解 rollup 插件们</a>→
      </span></p></div></div></div> <!----></main></div> <div class="footer"><div class="icons"></div> 
  Theme by
  <a href="https://github.com/xugaoyi/vuepress-theme-vdoing" target="_blank" title="本站主题">Vdoing</a> 
    | Copyright © 2017-2023
    <span>Jamey | blog <a href="http://beian.miit.gov.cn/" target="_blank">闽ICP备19022664号 </a></span></div> <div class="buttons"><div title="返回顶部" class="button blur go-to-top iconfont icon-fanhuidingbu" style="display:none;"></div> <div title="去评论" class="button blur go-to-comment iconfont icon-pinglun" style="display:none;"></div> <div title="主题模式" class="button blur theme-mode-but iconfont icon-zhuti"><ul class="select-box" style="display:none;"><li class="iconfont icon-zidong">
          跟随系统
        </li><li class="iconfont icon-rijianmoshi">
          浅色模式
        </li><li class="iconfont icon-yejianmoshi">
          深色模式
        </li><li class="iconfont icon-yuedu">
          阅读模式
        </li></ul></div></div> <!----> <!----> <!----></div><div class="global-ui"><div></div></div></div>
    <script src="/assets/js/app.8146073e.js" defer></script><script src="/assets/js/2.53e9b62d.js" defer></script><script src="/assets/js/179.43e3826f.js" defer></script><script src="/assets/js/4.49cfce35.js" defer></script>
  </body>
</html>
