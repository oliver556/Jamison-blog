(window.webpackJsonp=window.webpackJsonp||[]).push([[200],{535:function(s,t,a){"use strict";a.r(t);var n=a(7),e=Object(n.a)({},(function(){var s=this,t=s._self._c;return t("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[t("h1",{attrs:{id:"自定义指令介绍"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#自定义指令介绍"}},[s._v("#")]),s._v(" 自定义指令介绍")]),s._v(" "),t("h2",{attrs:{id:"📖-前言"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#📖-前言"}},[s._v("#")]),s._v(" 📖. 前言")]),s._v(" "),t("p",[s._v("在 Vue，除了核心功能默认内置的指令 ( "),t("code",[s._v("v-model")]),s._v(" 和 "),t("code",[s._v("v-show")]),s._v(" )，"),t("code",[s._v("Vue")]),s._v(" 也允许注册自定义指令。它的作用价值在于当开发人员在某些场景下需要对普通 "),t("code",[s._v("DOM")]),s._v(" 元素进行操作。")]),s._v(" "),t("h2",{attrs:{id:"一-什么是指令"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#一-什么是指令"}},[s._v("#")]),s._v(" 一. 什么是指令")]),s._v(" "),t("p",[s._v("开始之前我们先学习一下指令系统这个词。")]),s._v(" "),t("p",[t("strong",[s._v("指令系统")]),s._v(" 是计算机硬件的语言系统，也叫机器语言，它是系统程序员看到的计算机的主要属性。因此指令系统表征了计算机的基本功能决定了机器所要求的能力。")]),s._v(" "),t("p",[s._v("在 "),t("code",[s._v("vue")]),s._v(" 中提供了一套为数据驱动视图更为方便的操作，这些操作被称为指令系统。")]),s._v(" "),t("p",[s._v("我们看到的 "),t("code",[s._v("v-")]),s._v(" 开头的行内属性，都是指令，不同的指令可以完成或实现不同的功能。除了核心功能默认内置的指令（"),t("code",[s._v("v-model")]),s._v(" 和 "),t("code",[s._v("v-show")]),s._v("），"),t("code",[s._v("Vue")]),s._v(" 也允许注册自定义指令。")]),s._v(" "),t("ul",[t("li",[s._v("指令的几种使用方式")])]),s._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v('//会实例化一个指令，但这个指令没有参数 \n`v-xxx`\n\n// -- 将值传到指令中\n`v-xxx="value"`  \n\n// -- 将字符串传入到指令中，如`v-html="\'<p>内容</p>\'"`\n`v-xxx="\'string\'"` \n\n// -- 传参数（`arg`），如`v-bind:class="className"`\n`v-xxx:arg="value"` \n\n// -- 使用修饰符（`modifier`）\n`v-xxx:arg.modifier="value"` \n')])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br")])]),t("h2",{attrs:{id:"二-如何实现"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#二-如何实现"}},[s._v("#")]),s._v(" 二. 如何实现")]),s._v(" "),t("p",[s._v("注册一个自定义指令有全局注册与局部注册。")]),s._v(" "),t("h3",{attrs:{id:"_1-全局注册"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_1-全局注册"}},[s._v("#")]),s._v(" 1. 全局注册")]),s._v(" "),t("blockquote",[t("p",[s._v("全局注册主要是通过 "),t("code",[s._v("Vue.directive")]),s._v(" 方法进行注册。")])]),s._v(" "),t("p",[t("code",[s._v("Vue.directive")]),s._v(" 第一个参数是指指令的名字（不需要写上 "),t("code",[s._v("v-")]),s._v(" 前缀），第二个参数可以是对象数据，也可以是一个指令函数")]),s._v(" "),t("div",{staticClass:"language-js line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-js"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 注册一个全局自定义指令 `v-focus`")]),s._v("\nVue"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("directive")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'focus'")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 当被绑定的元素插入到 DOM 中时……")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token function-variable function"}},[s._v("inserted")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("function")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token parameter"}},[s._v("el")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 聚焦元素")]),s._v("\n    el"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("focus")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("  "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 页面加载完成之后自动让输入框获取到焦点的小功能")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br")])]),t("h3",{attrs:{id:"_2-局部注册"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_2-局部注册"}},[s._v("#")]),s._v(" 2. 局部注册")]),s._v(" "),t("blockquote",[t("p",[s._v("局部注册通过在组件 "),t("code",[s._v("options")]),s._v(" 选项中设置 "),t("code",[s._v("directive")]),s._v(" 属性")])]),s._v(" "),t("div",{staticClass:"language-vue line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-vue"}},[t("code",[t("span",{pre:!0,attrs:{class:"token tag"}},[t("span",{pre:!0,attrs:{class:"token tag"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),s._v("script")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),t("span",{pre:!0,attrs:{class:"token script"}},[t("span",{pre:!0,attrs:{class:"token language-javascript"}},[s._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("export")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("default")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token literal-property property"}},[s._v("directives")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token literal-property property"}},[s._v("focus")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n      "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 指令的定义")]),s._v("\n      "),t("span",{pre:!0,attrs:{class:"token function-variable function"}},[s._v("inserted")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("function")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token parameter"}},[s._v("el")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        el"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("focus")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 页面加载完成之后自动让输入框获取到焦点的小功能")]),s._v("\n      "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("  \n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),t("span",{pre:!0,attrs:{class:"token tag"}},[t("span",{pre:!0,attrs:{class:"token tag"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("</")]),s._v("script")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br")])]),t("p",[s._v("然后你可以在模板中任何元素上使用新的 v-focus property，如下：")]),s._v(" "),t("div",{staticClass:"language-html line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-html"}},[t("code",[t("span",{pre:!0,attrs:{class:"token tag"}},[t("span",{pre:!0,attrs:{class:"token tag"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),s._v("input")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token attr-name"}},[s._v("v-focus")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("/>")])]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("h3",{attrs:{id:"_3-指令钩子函数"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_3-指令钩子函数"}},[s._v("#")]),s._v(" 3. 指令钩子函数")]),s._v(" "),t("p",[s._v("自定义指令也像组件那样存在钩子函数：")]),s._v(" "),t("ul",[t("li",[t("code",[s._v("bind")]),s._v("：只调用一次，指令第一次绑定到元素时调用。在这里可以进行一次性的初始化设置。")]),s._v(" "),t("li",[t("code",[s._v("inserted")]),s._v(": 被绑定元素插入父节点时调用 (仅保证父节点存在，但不一定已被插入文档中)。")]),s._v(" "),t("li",[t("code",[s._v("update")]),s._v("：所在组件的 "),t("code",[s._v("VNode")]),s._v(" 更新时调用，但是可能发生在其子 "),t("code",[s._v("VNode")]),s._v(" 更新之前。指令的值可能发生了改变，也可能没有。但是你可以通过比较更新前后的值来忽略不必要的模板更新。")]),s._v(" "),t("li",[t("code",[s._v("componentUpdated")]),s._v("：指令所在组件的 "),t("code",[s._v("VNode")]),s._v(" 及其子 "),t("code",[s._v("VNode")]),s._v(" 全部更新后调用。")]),s._v(" "),t("li",[t("code",[s._v("unbind")]),s._v("：只调用一次，指令与元素解绑时调用。")])]),s._v(" "),t("blockquote",[t("p",[s._v("所有的钩子函数的参数都有以下：")])]),s._v(" "),t("ul",[t("li",[t("code",[s._v("el")]),s._v("：指令所绑定的元素，可以用来直接操作 "),t("code",[s._v("DOM")]),s._v("。")]),s._v(" "),t("li",[t("code",[s._v("binding")]),s._v("：一个对象，包含以下 "),t("code",[s._v("property")]),s._v("：\n"),t("ul",[t("li",[t("code",[s._v("name")]),s._v("：指令名，不包括 "),t("code",[s._v("v-")]),s._v(" 前缀。")]),s._v(" "),t("li",[t("code",[s._v("value")]),s._v("：指令的绑定值，例如："),t("code",[s._v('v-my-directive="1 + 1"')]),s._v(" 中，绑定值为 "),t("code",[s._v("2")]),s._v("。")]),s._v(" "),t("li",[t("code",[s._v("oldValue")]),s._v("：指令绑定的前一个值，仅在 "),t("code",[s._v("update")]),s._v(" 和 "),t("code",[s._v("componentUpdated")]),s._v(" 钩子中可用。无论值是否改变都可用。")]),s._v(" "),t("li",[t("code",[s._v("expression")]),s._v("：字符串形式的指令表达式。例如 "),t("code",[s._v('v-my-directive="1 + 1"')]),s._v(" 中，表达式为 "),t("code",[s._v("1 + 1")]),s._v("。")]),s._v(" "),t("li",[t("code",[s._v("arg")]),s._v("：传给指令的参数，可选。例如 "),t("code",[s._v("v-my-directive:foo")]),s._v(" 中，参数为 "),t("code",[s._v("foo")]),s._v("。")]),s._v(" "),t("li",[t("code",[s._v("modifiers")]),s._v("：一个包含修饰符的对象。例如："),t("code",[s._v("v-my-directive.foo.bar")]),s._v(" 中，修饰符对象为 "),t("code",[s._v("{ foo: true, bar: true }")]),s._v("。")])])]),s._v(" "),t("li",[t("code",[s._v("vnode")]),s._v("："),t("code",[s._v("Vue")]),s._v(" 编译生成的虚拟节点。")]),s._v(" "),t("li",[t("code",[s._v("oldVnode")]),s._v("：上一个虚拟节点，仅在 "),t("code",[s._v("update")]),s._v(" 和 "),t("code",[s._v("componentUpdated")]),s._v(" 钩子中可用。")])]),s._v(" "),t("blockquote",[t("p",[s._v("除了 "),t("code",[s._v("el")]),s._v(" 之外，其它参数都应该是只读的，切勿进行修改。如果需要在钩子之间共享数据，建议通过元素的 "),t("code",[s._v("dataset")]),s._v(" 来进行。")])]),s._v(" "),t("p",[s._v("举个例子：")]),s._v(" "),t("div",{staticClass:"language-html line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-html"}},[t("code",[t("span",{pre:!0,attrs:{class:"token tag"}},[t("span",{pre:!0,attrs:{class:"token tag"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),s._v("div")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token attr-name"}},[s._v("v-demo")]),t("span",{pre:!0,attrs:{class:"token attr-value"}},[t("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v('"')]),s._v("{ color: 'white', text: 'hello!' }"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v('"')])]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),t("span",{pre:!0,attrs:{class:"token tag"}},[t("span",{pre:!0,attrs:{class:"token tag"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("</")]),s._v("div")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token tag"}},[t("span",{pre:!0,attrs:{class:"token tag"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),s._v("script")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),t("span",{pre:!0,attrs:{class:"token script"}},[t("span",{pre:!0,attrs:{class:"token language-javascript"}},[s._v("\n    Vue"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("directive")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'demo'")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("function")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token parameter"}},[s._v("el"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" binding")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    console"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("log")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("binding"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("value"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("color"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v('// "white"')]),s._v("\n    console"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("log")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("binding"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("value"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("text"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("  "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v('// "hello!"')]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n")])]),t("span",{pre:!0,attrs:{class:"token tag"}},[t("span",{pre:!0,attrs:{class:"token tag"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("</")]),s._v("script")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br")])])])}),[],!1,null,null,null);t.default=e.exports}}]);