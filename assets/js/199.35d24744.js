(window.webpackJsonp=window.webpackJsonp||[]).push([[199],{534:function(t,a,s){"use strict";s.r(a);var e=s(7),n=Object(e.a)({},(function(){var t=this,a=t._self._c;return a("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[a("h1",{attrs:{id:"keep-alive-深入理解及实践总结"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#keep-alive-深入理解及实践总结"}},[t._v("#")]),t._v(" keep-alive 深入理解及实践总结")]),t._v(" "),a("h2",{attrs:{id:"📖-前言"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#📖-前言"}},[t._v("#")]),t._v(" 📖. 前言")]),t._v(" "),a("p",[t._v("在平常开发中，有部分组件没有必要多次初始化。这时，我们需要将组件进行持久化，"),a("strong",[t._v("使组件的状态维持不变")]),t._v("，在下一次展示时，也不会进行重新初始化组件。")]),t._v(" "),a("h2",{attrs:{id:"一-什么是-keep-alive"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#一-什么是-keep-alive"}},[t._v("#")]),t._v(" 一. 什么是 "),a("code",[t._v("keep-alive")])]),t._v(" "),a("p",[t._v("也就是说，"),a("code",[t._v("keepalive")]),t._v(" 是 "),a("code",[t._v("Vue")]),t._v(" 内置的一个组件，可以"),a("strong",[t._v("使被包含的组件保留状态，或避免重新渲染")]),t._v("。也就是所谓的"),a("strong",[t._v("组件缓存")])]),t._v(" "),a("p",[a("code",[t._v("keep-alive")]),t._v(" 是 Vue 的内置组件，能在组件切换过程中将状态保留在内部中，房东重复渲染 DOM。")]),t._v(" "),a("blockquote",[a("p",[a("code",[t._v("keep-alive")]),t._v(" 包裹动态组件时，会缓存不活动的组件实例，而不是销毁它们。和 "),a("code",[t._v("<transition>")]),t._v(" 相似，"),a("code",[t._v("keep-alive")]),t._v(" 是一个抽象组件：它自身不会渲染一个 "),a("code",[t._v("DOM")]),t._v(" 元素，也不会出现在父组件链中。")])]),t._v(" "),a("p",[a("strong",[t._v("prop:")])]),t._v(" "),a("ul",[a("li",[a("code",[t._v("include")]),t._v(" → 字符串或正则表达式。只有匹配的组件会被缓存。")]),t._v(" "),a("li",[a("code",[t._v("exclude")]),t._v(" → 字符串或正则表达式。任何匹配的组件都不会被缓存。")])]),t._v(" "),a("h2",{attrs:{id:"二-声明周期执行顺序"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#二-声明周期执行顺序"}},[t._v("#")]),t._v(" 二. 声明周期执行顺序")]),t._v(" "),a("ul",[a("li",[t._v("页面第一次进入，钩子的触发顺序: "),a("code",[t._v("created → mounted → activated")]),t._v("；退出时触发 "),a("code",[t._v("deactivated")]),t._v("；当再次进入（前进或者后退）时，只触发 "),a("code",[t._v("activated")])]),t._v(" "),a("li",[t._v("事件挂载的方法等，只执行一次的放在 "),a("code",[t._v("mounted")]),t._v(" 中；组件每次进去执行的方法放在 "),a("code",[t._v("activated")]),t._v(" 中")])]),t._v(" "),a("h2",{attrs:{id:"三-基本用法"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#三-基本用法"}},[t._v("#")]),t._v(" 三. 基本用法")]),t._v(" "),a("div",{staticClass:"language-html line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-html"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("\x3c!--被keepalive包含的组件会被缓存--\x3e")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("keep-alive")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("component")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("component")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("/>")])]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("keep-alive")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n")])]),t._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[t._v("1")]),a("br"),a("span",{staticClass:"line-number"},[t._v("2")]),a("br"),a("span",{staticClass:"line-number"},[t._v("3")]),a("br"),a("span",{staticClass:"line-number"},[t._v("4")]),a("br")])]),a("p",[t._v("被 "),a("code",[t._v("keepalive")]),t._v(" 包含的组件不会被再次初始化，也就意味着"),a("strong",[t._v("不会重走生命周期函数")])]),t._v(" "),a("p",[t._v("但是有时候是希望我们缓存的组件可以能够再次进行渲染，这时 "),a("code",[t._v("Vue")]),t._v(" 为我们解决了这个问题。被包含在 "),a("code",[t._v("keep-alive")]),t._v(" 中创建的组件，会多出两个生命周期的钩子："),a("code",[t._v("activated")]),t._v(" 与 "),a("code",[t._v("deactivated")]),t._v("：")]),t._v(" "),a("ul",[a("li",[a("code",[t._v("activated")]),t._v(" 当 "),a("code",[t._v("keepalive")]),t._v(" 包含的组件再次渲染的时候触发")]),t._v(" "),a("li",[a("code",[t._v("deactivated")]),t._v(" 当 "),a("code",[t._v("keepalive")]),t._v(" 包含的组件销毁的时候触发")])]),t._v(" "),a("p",[a("code",[t._v("keepalive")]),t._v(" 是一个抽象的组件，缓存的组件不会被 "),a("code",[t._v("mounted")]),t._v("，为此提供 "),a("code",[t._v("activated")]),t._v(" 和 "),a("code",[t._v("deactivated")]),t._v(" 钩子函数")]),t._v(" "),a("h2",{attrs:{id:"四-参数理解"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#四-参数理解"}},[t._v("#")]),t._v(" 四. 参数理解")]),t._v(" "),a("p",[a("code",[t._v("keepalive")]),t._v(" 可以接收 3 个属性做为参考进行匹配对应的组件进行缓存：")]),t._v(" "),a("ul",[a("li",[a("code",[t._v("include")]),t._v(" → 包含的组件（可以为字符串，数组，以及正则表达式，只有匹配的组件会被缓存）")]),t._v(" "),a("li",[a("code",[t._v("exclude")]),t._v(" → 排除的组件（以为字符串，数组，以及正则表达式，任何匹配的组件都不会被缓存）")]),t._v(" "),a("li",[a("code",[t._v("max")]),t._v(" → 缓存组件的最大值（类型为字符串或者数字，可以控制缓存组件的个数）")])]),t._v(" "),a("blockquote",[a("p",[a("strong",[t._v("注：当使用正则表达式或者数组时，一定要用 "),a("code",[t._v("v-bind")])])])]),t._v(" "),a("div",{staticClass:"language-html line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-html"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("\x3c!-- 将（只）缓存组件 name 为 a 或者 b 的组件, 结合动态组件使用 --\x3e")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("keep-alive")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("include")]),a("span",{pre:!0,attrs:{class:"token attr-value"}},[a("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')]),t._v("a,b"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')])]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("component")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("component")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("keep-alive")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("\x3c!-- 组件 name 为 c 的组件不缓存(可以保留它的状态或避免重新渲染) --\x3e")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("keep-alive")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("exclude")]),a("span",{pre:!0,attrs:{class:"token attr-value"}},[a("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')]),t._v("c"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')])]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v(" \n  "),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("component")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("component")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("keep-alive")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("\x3c!-- 使用正则表达式，需使用 v-bind --\x3e")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("keep-alive")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v(":include")]),a("span",{pre:!0,attrs:{class:"token attr-value"}},[a("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')]),t._v("/a|b/"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')])]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("component")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v(":is")]),a("span",{pre:!0,attrs:{class:"token attr-value"}},[a("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')]),t._v("view"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')])]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("component")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("keep-alive")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("\x3c!-- 动态判断 --\x3e")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("keep-alive")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v(":include")]),a("span",{pre:!0,attrs:{class:"token attr-value"}},[a("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')]),t._v("includedComponents"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')])]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("router-view")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("router-view")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("keep-alive")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("\x3c!-- 如果同时使用 include,exclude,那么 exclude 优先于 include， 下面的例子只缓存 a 组件 --\x3e")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("keep-alive")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("include")]),a("span",{pre:!0,attrs:{class:"token attr-value"}},[a("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')]),t._v("a,b"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')])]),t._v(" "),a("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("exclude")]),a("span",{pre:!0,attrs:{class:"token attr-value"}},[a("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')]),t._v("b"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')])]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v(" \n  "),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("component")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("component")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("keep-alive")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("\x3c!-- 如果缓存的组件超过了 max 设定的值 5，那么将删除第一个缓存的组件 --\x3e")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("keep-alive")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("exclude")]),a("span",{pre:!0,attrs:{class:"token attr-value"}},[a("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')]),t._v("c"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')])]),t._v(" "),a("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("max")]),a("span",{pre:!0,attrs:{class:"token attr-value"}},[a("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')]),t._v("5"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')])]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v(" \n  "),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("component")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("component")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("keep-alive")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n")])]),t._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[t._v("1")]),a("br"),a("span",{staticClass:"line-number"},[t._v("2")]),a("br"),a("span",{staticClass:"line-number"},[t._v("3")]),a("br"),a("span",{staticClass:"line-number"},[t._v("4")]),a("br"),a("span",{staticClass:"line-number"},[t._v("5")]),a("br"),a("span",{staticClass:"line-number"},[t._v("6")]),a("br"),a("span",{staticClass:"line-number"},[t._v("7")]),a("br"),a("span",{staticClass:"line-number"},[t._v("8")]),a("br"),a("span",{staticClass:"line-number"},[t._v("9")]),a("br"),a("span",{staticClass:"line-number"},[t._v("10")]),a("br"),a("span",{staticClass:"line-number"},[t._v("11")]),a("br"),a("span",{staticClass:"line-number"},[t._v("12")]),a("br"),a("span",{staticClass:"line-number"},[t._v("13")]),a("br"),a("span",{staticClass:"line-number"},[t._v("14")]),a("br"),a("span",{staticClass:"line-number"},[t._v("15")]),a("br"),a("span",{staticClass:"line-number"},[t._v("16")]),a("br"),a("span",{staticClass:"line-number"},[t._v("17")]),a("br"),a("span",{staticClass:"line-number"},[t._v("18")]),a("br"),a("span",{staticClass:"line-number"},[t._v("19")]),a("br"),a("span",{staticClass:"line-number"},[t._v("20")]),a("br"),a("span",{staticClass:"line-number"},[t._v("21")]),a("br"),a("span",{staticClass:"line-number"},[t._v("22")]),a("br"),a("span",{staticClass:"line-number"},[t._v("23")]),a("br"),a("span",{staticClass:"line-number"},[t._v("24")]),a("br"),a("span",{staticClass:"line-number"},[t._v("25")]),a("br"),a("span",{staticClass:"line-number"},[t._v("26")]),a("br"),a("span",{staticClass:"line-number"},[t._v("27")]),a("br"),a("span",{staticClass:"line-number"},[t._v("28")]),a("br"),a("span",{staticClass:"line-number"},[t._v("29")]),a("br")])]),a("h2",{attrs:{id:"五-缓存部分页面"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#五-缓存部分页面"}},[t._v("#")]),t._v(" 五. 缓存部分页面")]),t._v(" "),a("p",[t._v("结合 "),a("code",[t._v("vue-router")]),t._v(" 和 "),a("code",[t._v("router")]),t._v(" 使用，实现缓存部分页面效果。")]),t._v(" "),a("h3",{attrs:{id:"_1-全缓存"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_1-全缓存"}},[t._v("#")]),t._v(" 1. 全缓存")]),t._v(" "),a("p",[t._v("所有路径下的视图组件都会被缓存")]),t._v(" "),a("div",{staticClass:"language-html line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-html"}},[a("code",[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("keep-alive")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("router-view")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("\x3c!-- 所有路径匹配到的视图组件都会被缓存！ --\x3e")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("router-view")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("keep-alive")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n")])]),t._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[t._v("1")]),a("br"),a("span",{staticClass:"line-number"},[t._v("2")]),a("br"),a("span",{staticClass:"line-number"},[t._v("3")]),a("br"),a("span",{staticClass:"line-number"},[t._v("4")]),a("br"),a("span",{staticClass:"line-number"},[t._v("5")]),a("br")])]),a("h3",{attrs:{id:"_2-部分缓存"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_2-部分缓存"}},[t._v("#")]),t._v(" 2. 部分缓存")]),t._v(" "),a("p",[t._v("如果只想要 "),a("code",[t._v("router-view")]),t._v(" 里面的某个组件被缓存，怎么办？")]),t._v(" "),a("ul",[a("li",[t._v("使用 "),a("code",[t._v("include")]),t._v(" / "),a("code",[t._v("exclude")])]),t._v(" "),a("li",[t._v("使用 "),a("code",[t._v("meta")]),t._v(" 属性")])]),t._v(" "),a("ol",[a("li",[t._v("用 "),a("code",[t._v("include")]),t._v("（"),a("code",[t._v("exclude")]),t._v(" 例子类似）")])]),t._v(" "),a("blockquote",[a("p",[t._v("缺点：需要知道组件的 name，项目复杂的时候不是很好的选择")])]),t._v(" "),a("div",{staticClass:"language-html line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-html"}},[a("code",[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("keep-alive")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("include")]),a("span",{pre:!0,attrs:{class:"token attr-value"}},[a("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')]),t._v("a"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')])]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("router-view")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("\x3c!-- 只有路径匹配到的 include 为 a 组件会被缓存 --\x3e")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("router-view")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("keep-alive")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n")])]),t._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[t._v("1")]),a("br"),a("span",{staticClass:"line-number"},[t._v("2")]),a("br"),a("span",{staticClass:"line-number"},[t._v("3")]),a("br"),a("span",{staticClass:"line-number"},[t._v("4")]),a("br"),a("span",{staticClass:"line-number"},[t._v("5")]),a("br")])]),a("ol",{attrs:{start:"2"}},[a("li",[t._v("使用 "),a("code",[t._v("meta")]),t._v(" 属性")])]),t._v(" "),a("blockquote",[a("p",[t._v("优点：不需要李决出需要被缓存组件名称")])]),t._v(" "),a("p",[t._v("使用 "),a("code",[t._v("$route.meta")]),t._v(" 的 "),a("code",[t._v("keepAlive")]),t._v(" 属性：")]),t._v(" "),a("div",{staticClass:"language-html line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-html"}},[a("code",[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("keep-alive")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("router-view")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("v-if")]),a("span",{pre:!0,attrs:{class:"token attr-value"}},[a("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')]),t._v("$route.meta.keepAlive"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')])]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("router-view")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("keep-alive")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("router-view")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("v-if")]),a("span",{pre:!0,attrs:{class:"token attr-value"}},[a("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')]),t._v("!$route.meta.keepAlive"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')])]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("router-view")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n")])]),t._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[t._v("1")]),a("br"),a("span",{staticClass:"line-number"},[t._v("2")]),a("br"),a("span",{staticClass:"line-number"},[t._v("3")]),a("br"),a("span",{staticClass:"line-number"},[t._v("4")]),a("br"),a("span",{staticClass:"line-number"},[t._v("5")]),a("br")])]),a("p",[t._v("需要在 "),a("code",[t._v("router")]),t._v(" 中设置 router 的元信息 meta：")]),t._v(" "),a("div",{staticClass:"language-vue line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-vue"}},[a("code",[t._v("//...router.js\nexport default new Router({\n  routes: [\n    {\n      path: '/',\n      name: 'Hello',\n      component: Hello,\n      meta: {\n        keepAlive: false // 不需要缓存\n      }\n    },\n    {\n      path: '/page1',\n      name: 'Page1',\n      component: Page1,\n      meta: {\n        keepAlive: true // 需要被缓存\n      }\n    }\n  ]\n})\n")])]),t._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[t._v("1")]),a("br"),a("span",{staticClass:"line-number"},[t._v("2")]),a("br"),a("span",{staticClass:"line-number"},[t._v("3")]),a("br"),a("span",{staticClass:"line-number"},[t._v("4")]),a("br"),a("span",{staticClass:"line-number"},[t._v("5")]),a("br"),a("span",{staticClass:"line-number"},[t._v("6")]),a("br"),a("span",{staticClass:"line-number"},[t._v("7")]),a("br"),a("span",{staticClass:"line-number"},[t._v("8")]),a("br"),a("span",{staticClass:"line-number"},[t._v("9")]),a("br"),a("span",{staticClass:"line-number"},[t._v("10")]),a("br"),a("span",{staticClass:"line-number"},[t._v("11")]),a("br"),a("span",{staticClass:"line-number"},[t._v("12")]),a("br"),a("span",{staticClass:"line-number"},[t._v("13")]),a("br"),a("span",{staticClass:"line-number"},[t._v("14")]),a("br"),a("span",{staticClass:"line-number"},[t._v("15")]),a("br"),a("span",{staticClass:"line-number"},[t._v("16")]),a("br"),a("span",{staticClass:"line-number"},[t._v("17")]),a("br"),a("span",{staticClass:"line-number"},[t._v("18")]),a("br"),a("span",{staticClass:"line-number"},[t._v("19")]),a("br"),a("span",{staticClass:"line-number"},[t._v("20")]),a("br"),a("span",{staticClass:"line-number"},[t._v("21")]),a("br")])]),a("h2",{attrs:{id:"六-加盐-router-meta-拓展"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#六-加盐-router-meta-拓展"}},[t._v("#")]),t._v(" 六. 加盐：router.meta 拓展")]),t._v(" "),a("p",[t._v("假设这里有 3 个路由：A、B、C")]),t._v(" "),a("ul",[a("li",[a("p",[t._v("需求：")]),t._v(" "),a("ul",[a("li",[t._v("默认显示 A")]),t._v(" "),a("li",[t._v("B 跳到 A，A 不刷新")]),t._v(" "),a("li",[t._v("C 调到 A，A 刷新")])])]),t._v(" "),a("li",[a("p",[t._v("实现方式")])])]),t._v(" "),a("ol",[a("li",[t._v("在 A 路由里面设置 meta 属性：")])]),t._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("{\n  path: '/',\n  name: 'A',\n  component: A,\n  meta: {\n    keepAlive: true // 需要被缓存\n  }\n}\n")])]),t._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[t._v("1")]),a("br"),a("span",{staticClass:"line-number"},[t._v("2")]),a("br"),a("span",{staticClass:"line-number"},[t._v("3")]),a("br"),a("span",{staticClass:"line-number"},[t._v("4")]),a("br"),a("span",{staticClass:"line-number"},[t._v("5")]),a("br"),a("span",{staticClass:"line-number"},[t._v("6")]),a("br"),a("span",{staticClass:"line-number"},[t._v("7")]),a("br"),a("span",{staticClass:"line-number"},[t._v("8")]),a("br")])]),a("ol",{attrs:{start:"2"}},[a("li",[t._v("在 B 组件里面设置 "),a("code",[t._v("beforeRouteLeave")]),t._v(":")])]),t._v(" "),a("div",{staticClass:"language-vue line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-vue"}},[a("code",[t._v("export default {\n  data() {\n    return {};\n  },\n  methods: {},\n  beforeRouteLeave(to, from, next) {\n    // 设置下一个路由的 meta\n    to.meta.keepAlive = true;  // 让 A 缓存，即不刷新\n    next();\n  }\n};\n")])]),t._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[t._v("1")]),a("br"),a("span",{staticClass:"line-number"},[t._v("2")]),a("br"),a("span",{staticClass:"line-number"},[t._v("3")]),a("br"),a("span",{staticClass:"line-number"},[t._v("4")]),a("br"),a("span",{staticClass:"line-number"},[t._v("5")]),a("br"),a("span",{staticClass:"line-number"},[t._v("6")]),a("br"),a("span",{staticClass:"line-number"},[t._v("7")]),a("br"),a("span",{staticClass:"line-number"},[t._v("8")]),a("br"),a("span",{staticClass:"line-number"},[t._v("9")]),a("br"),a("span",{staticClass:"line-number"},[t._v("10")]),a("br"),a("span",{staticClass:"line-number"},[t._v("11")]),a("br")])]),a("ol",{attrs:{start:"3"}},[a("li",[t._v("在 C 组件里面设置 "),a("code",[t._v("beforeRouteLeave")]),t._v(":")])]),t._v(" "),a("div",{staticClass:"language-vue line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-vue"}},[a("code",[t._v("export default {\n  data() {\n    return {};\n  },\n  methods: {},\n  beforeRouteLeave(to, from, next) {\n    // 设置下一个路由的 meta\n    to.meta.keepAlive = false; // 让 A 不缓存，即刷新\n    next();\n  }\n};\n")])]),t._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[t._v("1")]),a("br"),a("span",{staticClass:"line-number"},[t._v("2")]),a("br"),a("span",{staticClass:"line-number"},[t._v("3")]),a("br"),a("span",{staticClass:"line-number"},[t._v("4")]),a("br"),a("span",{staticClass:"line-number"},[t._v("5")]),a("br"),a("span",{staticClass:"line-number"},[t._v("6")]),a("br"),a("span",{staticClass:"line-number"},[t._v("7")]),a("br"),a("span",{staticClass:"line-number"},[t._v("8")]),a("br"),a("span",{staticClass:"line-number"},[t._v("9")]),a("br"),a("span",{staticClass:"line-number"},[t._v("10")]),a("br"),a("span",{staticClass:"line-number"},[t._v("11")]),a("br")])]),a("p",[t._v("这样便能实现 B 回到 A，A 不刷新；而 C 回到 A 则刷新。")]),t._v(" "),a("h2",{attrs:{id:"七-防坑指南"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#七-防坑指南"}},[t._v("#")]),t._v(" 七. 防坑指南")]),t._v(" "),a("ol",[a("li",[a("code",[t._v("keep-alive")]),t._v(" 先匹配被包含组件的 "),a("code",[t._v("name")]),t._v(" 字段，如果 "),a("code",[t._v("那么")]),t._v(" 不可用，匹配当前组件 "),a("code",[t._v("components")]),t._v(" 配置中的注册名称。")]),t._v(" "),a("li",[a("code",[t._v("keep-alive")]),t._v(" 不会在函数式组件中正常工作，因为它们没有缓存实例。")]),t._v(" "),a("li",[t._v("当匹配条件同时在 "),a("code",[t._v("include")]),t._v(" 与 "),a("code",[t._v("exclude")]),t._v(" 存在时，以 "),a("code",[t._v("exclude")]),t._v(" 优先级最高（当前 vue 2.4.2 version）。比如：包含于排除同时匹配到了组件 A，那组件 A 不会被缓存。")]),t._v(" "),a("li",[t._v("包含在 "),a("code",[t._v("keep-alive")]),t._v("中，但符合 "),a("code",[t._v("exclude")]),t._v("，不会调用 "),a("code",[t._v("activated")]),t._v(" 和 "),a("code",[t._v("deactivated")]),t._v("。")])]),t._v(" "),a("p",[a("strong",[t._v("实现前进刷新，后退不刷新")]),t._v("，感谢 "),a("a",{attrs:{href:"https://www.jianshu.com/u/beced864ad95",target:"_blank",rel:"noopener noreferrer"}},[t._v("iceuncle"),a("OutboundLink")],1),t._v(" 分享的 "),a("a",{attrs:{href:"https://juejin.im/post/6844903555657269261",target:"_blank",rel:"noopener noreferrer"}},[t._v("《vue实现前进刷新，后退不刷新》"),a("OutboundLink")],1),t._v(" 。")]),t._v(" "),a("h2",{attrs:{id:"八-总结"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#八-总结"}},[t._v("#")]),t._v(" 八. 总结")]),t._v(" "),a("p",[t._v("路由大法不错，不需要关心哪个页面跳转过来的，只要 "),a("code",[t._v("router.go(-1)")]),t._v(" 就能回去，不需要额外参数。")]),t._v(" "),a("p",[t._v("在非单页应用的时候，"),a("code",[t._v("keep-alive")]),t._v(" 并不能有效的缓存了 = =")]),t._v(" "),a("p",[t._v("keep-alive 生命周期钩子函数：activated、deactivated")]),t._v(" "),a("p",[t._v("使用 "),a("code",[t._v("<keep-alive>")]),t._v(" 会将数据保留在内存中，如果要在每次进入页面的时候获取最新的数据，需要在 "),a("code",[t._v("activated")]),t._v(" 阶段获取数据，承担原来 "),a("code",[t._v("created")]),t._v(" 钩子中获取数据的任务。")]),t._v(" "),a("h2",{attrs:{id:"九-附录"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#九-附录"}},[t._v("#")]),t._v(" 九. 附录")]),t._v(" "),a("p",[t._v("生命周期函数：就是 vue 在某个时间段会自动执行的函数")]),t._v(" "),a("ol",[a("li",[a("code",[t._v("beforeCreate() {}")]),t._v(" → 在执行的时候，data 还有 methods 都还没有被初始化。")]),t._v(" "),a("li",[a("code",[t._v("created() {}")]),t._v(" → data 还有 methods 都被初始化好了，如果要调用 "),a("code",[t._v("methods")]),t._v(" 方法或者操作 "),a("code",[t._v("data")]),t._v(" 里面的数据，最早只能在 "),a("code",[t._v("created")]),t._v(" 里面进行操作。")]),t._v(" "),a("li",[a("code",[t._v("beforeMount() {}")]),t._v(" → 表示模板已经在内存中编译完成了，但是尚未渲染到模板页面中。即页面中的元素，没有被真正的替换过来，只是之前写的一些模板字符串。")]),t._v(" "),a("li",[a("code",[t._v("mounted() {}")]),t._v(" → 表示内存中模板已经真实的挂载到页面中去了，用户可以看到渲染好的界面了。\n"),a("blockquote",[a("ul",[a("li",[a("strong",[t._v("注意")]),t._v("：这是生命周期函数的最后一个函数了，执行完这个函数表示：整个 vue 实例已经初始化完成了，组件脱离了创建阶段，进入运行阶段。")]),t._v(" "),a("li",[t._v("下面是运行期间的两个生命周期函数的钩子：")])])])]),t._v(" "),a("li",[a("code",[t._v("beforeUpdate() {}")]),t._v(" → 表示我们的界面还没更新，但是 data 里面的数据是最新的。即页面尚未和最新的 data 里面的数据保持同步。")]),t._v(" "),a("li",[a("code",[t._v("updated() {}")]),t._v(" → 表示页面和 data 里面的数据已经保持同步了，都是最新的。")]),t._v(" "),a("li",[a("code",[t._v("beforeDestory() {}")]),t._v(" → 当执行这个生命周期钩子的时候，vue 的实例从运行阶段进入销毁阶段。此时实例身上的 data 还有 methods 处于可用的状态。")]),t._v(" "),a("li",[a("code",[t._v("destoryed() {}")]),t._v(" → 表示组件已经完全销毁了，组件中所有的实例方法都不能用了。")])]),t._v(" "),a("h2",{attrs:{id:"参考"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#参考"}},[t._v("#")]),t._v(" 参考")]),t._v(" "),a("ul",[a("li",[a("a",{attrs:{href:"https://github.com/vuejs/vue-router/issues/811",target:"_blank",rel:"noopener noreferrer"}},[t._v("issues#811"),a("OutboundLink")],1)]),t._v(" "),a("li",[a("a",{attrs:{href:"https://cn.vuejs.org/v2/api/#keep-alive",target:"_blank",rel:"noopener noreferrer"}},[t._v("vue#keep-alive"),a("OutboundLink")],1)]),t._v(" "),a("li",[a("a",{attrs:{href:"https://segmentfault.com/a/1190000008123035",target:"_blank",rel:"noopener noreferrer"}},[t._v("vue2.0 keep-alive最佳实践"),a("OutboundLink")],1)])])])}),[],!1,null,null,null);a.default=n.exports}}]);