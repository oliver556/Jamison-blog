(window.webpackJsonp=window.webpackJsonp||[]).push([[230],{565:function(t,a,e){"use strict";e.r(a);var s=e(7),r=Object(s.a)({},(function(){var t=this,a=t._self._c;return a("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[a("h1",{attrs:{id:"前端解决第三方图片防盗链的办法-html-referrer-访问图片资源-403-问题"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#前端解决第三方图片防盗链的办法-html-referrer-访问图片资源-403-问题"}},[t._v("#")]),t._v(" 前端解决第三方图片防盗链的办法 - html referrer 访问图片资源 403 问题")]),t._v(" "),a("h2",{attrs:{id:"一-问题"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#一-问题"}},[t._v("#")]),t._v(" 一. 问题")]),t._v(" "),a("p",[t._v("笔者网站的图片都是上传到第三方网站上的，比如 简书、掘金、七牛云上的，但是最近简书和掘金都开启了 防盗链，防止其他网站访问他们网站上的图片了，导致笔者的网站存在他们网站上的图片全挂了。")]),t._v(" "),a("p",[t._v("具体问题，就是 "),a("code",[t._v("html")]),t._v(" 中通过 "),a("code",[t._v("img")]),t._v(" 标签引入一个第三方的图片地址，报 "),a("code",[t._v("403")]),t._v(" 。但是这个图片地址直接复制出来在地址栏打开，却是看得到的。")]),t._v(" "),a("h2",{attrs:{id:"二-原因"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#二-原因"}},[t._v("#")]),t._v(" 二. 原因")]),t._v(" "),a("p",[t._v("官方输出图片的时候，判断了来源 "),a("code",[t._v("Referer")]),t._v(" ，就是从哪个网站访问这个图片，如果是你的网站去加载这个图片，那么 "),a("code",[t._v("Referer")]),t._v(" 就是：你的网站地址；")]),t._v(" "),a("p",[t._v("如果我们的网站地址不在官方的白名单内，所以就看不到图片了。")]),t._v(" "),a("p",[t._v("我们做这个跳板的关键：不发送 "),a("code",[t._v("Referer")]),t._v("，也就是没有来源。那么官方那边，就认为是从浏览器直接访问的，所以就能加载正常的图片了。")]),t._v(" "),a("h2",{attrs:{id:"三-referrer"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#三-referrer"}},[t._v("#")]),t._v(" 三. referrer")]),t._v(" "),a("p",[t._v("在某些情况下，出于一些原因，网站想要控制页面发送给 "),a("code",[t._v("server")]),t._v(" 的 "),a("code",[t._v("referrer")]),t._v(" 信息的情况下，可以使用这一 "),a("code",[t._v("referer")]),t._v(" "),a("code",[t._v("metadata")]),t._v(" 参数。")]),t._v(" "),a("h3",{attrs:{id:"_1-参数"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_1-参数"}},[t._v("#")]),t._v(" 1. 参数")]),t._v(" "),a("p",[a("code",[t._v("referer")]),t._v(" 的 "),a("code",[t._v("metedata")]),t._v(" 属性可设置 "),a("code",[t._v("content")]),t._v(" 属性值为以下集合：")]),t._v(" "),a("ul",[a("li",[t._v("never")]),t._v(" "),a("li",[t._v("always")]),t._v(" "),a("li",[t._v("origin")])]),t._v(" "),a("h3",{attrs:{id:"_2-结果"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_2-结果"}},[t._v("#")]),t._v(" 2. 结果")]),t._v(" "),a("ul",[a("li",[t._v("如果 "),a("code",[t._v("referer-policy")]),t._v(" 的值为 "),a("code",[t._v("never")]),t._v("：删除 http head 中的 referer；")]),t._v(" "),a("li",[t._v("如果 "),a("code",[t._v("referer-policy")]),t._v(" 的值为 "),a("code",[t._v("default")]),t._v("：如果当前页面使用的是 https 协议，而正要加载资源使用的是普通的 http 协议，则将 http header 中额 referer 置为空；")]),t._v(" "),a("li",[t._v("如果 "),a("code",[t._v("referer-policy")]),t._v(" 的值 "),a("code",[t._v("origin")]),t._v("：只发送 origin 部分；")]),t._v(" "),a("li",[t._v("如果 "),a("code",[t._v("referer-policy")]),t._v(" 的值为 "),a("code",[t._v("always")]),t._v("：不改变 http header 中的 referer 的值；")])]),t._v(" "),a("h3",{attrs:{id:"_3-举例"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_3-举例"}},[t._v("#")]),t._v(" 3. 举例")]),t._v(" "),a("p",[t._v("如果页面中包含了如下 "),a("code",[t._v("meta")]),t._v(" 标签，所有从当前页面中发起的请求将不会携带 "),a("code",[t._v("referer")]),t._v("：")]),t._v(" "),a("div",{staticClass:"language-html line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-html"}},[a("code",[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("meta")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("name")]),a("span",{pre:!0,attrs:{class:"token attr-value"}},[a("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')]),t._v("referrer"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')])]),t._v(" "),a("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("content")]),a("span",{pre:!0,attrs:{class:"token attr-value"}},[a("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')]),t._v("never"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')])]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n")])]),t._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[t._v("1")]),a("br")])]),a("p",[t._v("如果页面中包含了如下 "),a("code",[t._v("meta")]),t._v(" 标签，则从当前页面中发起的 http 请求将只携带 origin 部分：")]),t._v(" "),a("div",{staticClass:"language-html line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-html"}},[a("code",[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("meta")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("name")]),a("span",{pre:!0,attrs:{class:"token attr-value"}},[a("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')]),t._v("referrer"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')])]),t._v(" "),a("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("content")]),a("span",{pre:!0,attrs:{class:"token attr-value"}},[a("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')]),t._v("origin"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')])]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n")])]),t._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[t._v("1")]),a("br")])]),a("h2",{attrs:{id:"四-解决方案"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#四-解决方案"}},[t._v("#")]),t._v(" 四. 解决方案")]),t._v(" "),a("h3",{attrs:{id:"_1-初步方案"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_1-初步方案"}},[t._v("#")]),t._v(" 1. 初步方案")]),t._v(" "),a("ul",[a("li",[t._v("在 标签里加 "),a("code",[t._v("meta")]),t._v("，"),a("code",[t._v("referrer")]),t._v(" 的 "),a("code",[t._v("content")]),t._v(" 设置为 "),a("code",[t._v("nerver")]),t._v("。")])]),t._v(" "),a("div",{staticClass:"language-html line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-html"}},[a("code",[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("meta")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("name")]),a("span",{pre:!0,attrs:{class:"token attr-value"}},[a("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')]),t._v("referrer"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')])]),t._v(" "),a("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("content")]),a("span",{pre:!0,attrs:{class:"token attr-value"}},[a("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')]),t._v("never"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')])]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n")])]),t._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[t._v("1")]),a("br")])]),a("p",[t._v("这样存在第三方网站上的图片，在你的网站上就可以访问了。")]),t._v(" "),a("p",[t._v("但是还有一个问题，就是如果你的网站需要发送你的网站地址的，那上面的的设置就不行了，比如：用到了百度统计。")]),t._v(" "),a("p",[t._v("那上面的设置会导致百度统计的代码加载不了，因为它需要发送 "),a("strong",[t._v("你的网站地址")]),t._v(" 给百度统计。")]),t._v(" "),a("p",[a("strong",[t._v("既要不发送 你的网站地址，又要发送你的网站地址，那么怎么办呢 ？")])]),t._v(" "),a("h3",{attrs:{id:"_2-最终解决方案"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_2-最终解决方案"}},[t._v("#")]),t._v(" 2. 最终解决方案")]),t._v(" "),a("ul",[a("li",[t._v("先在 "),a("code",[t._v("html")]),t._v(" 上设置 "),a("code",[t._v("referrer")]),t._v(" 为 "),a("code",[t._v("always")]),t._v("。")])]),t._v(" "),a("div",{staticClass:"language-html line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-html"}},[a("code",[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("meta")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("id")]),a("span",{pre:!0,attrs:{class:"token attr-value"}},[a("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')]),t._v("referrer"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')])]),t._v(" "),a("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("name")]),a("span",{pre:!0,attrs:{class:"token attr-value"}},[a("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')]),t._v("referrer"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')])]),t._v(" "),a("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("content")]),a("span",{pre:!0,attrs:{class:"token attr-value"}},[a("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')]),t._v("always"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')])]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("/>")])]),t._v("\n")])]),t._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[t._v("1")]),a("br")])]),a("p",[t._v("这样之后，首屏加载的时候，加载了百度统计的代码了，能正常统计访客数据了。")]),t._v(" "),a("ul",[a("li",[t._v("不需要网站地址的时候，再把 "),a("code",[t._v("referrer")]),t._v(" 设置为 "),a("code",[t._v("nerver")])])]),t._v(" "),a("p",[t._v("加个延时 setTimeout 再把 "),a("code",[t._v("referrer")]),t._v(" 的 "),a("code",[t._v("content")]),t._v(" 值设置为 "),a("code",[t._v("nerver")]),t._v(" 。"),a("br"),t._v("\n或者 在有图片的地方再把 "),a("code",[t._v("referrer")]),t._v(" 的 "),a("code",[t._v("content")]),t._v(" 值设置为 "),a("code",[t._v("nerver")]),t._v(" 。")]),t._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v('const referrer  = document.getElementById("referrer");\nreferrer.setAttribute("content", "never")\n')])]),t._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[t._v("1")]),a("br"),a("span",{staticClass:"line-number"},[t._v("2")]),a("br")])]),a("p",[t._v("这样就能解决第三方图片防盗链，又能用到百度统计了。")])])}),[],!1,null,null,null);a.default=r.exports}}]);