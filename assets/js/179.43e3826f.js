(window.webpackJsonp=window.webpackJsonp||[]).push([[179],{514:function(s,t,a){"use strict";a.r(t);var n=a(7),e=Object(n.a)({},(function(){var s=this,t=s._self._c;return t("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[t("h1",{attrs:{id:"rollup-输出的-6-种格式"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#rollup-输出的-6-种格式"}},[s._v("#")]),s._v(" rollup 输出的 6 种格式")]),s._v(" "),t("blockquote",[t("p",[s._v("之前找工作的时候因为在简历上写“熟练使用 rollup.js 进行构建”，但回答不出 rollup 能打包出哪几种格式，我差点被面试官鄙视。")])]),s._v(" "),t("blockquote",[t("p",[s._v("确实不应该！")])]),s._v(" "),t("blockquote",[t("p",[s._v("于是重新学习和梳理了一遍，和大家一起分享。")])]),s._v(" "),t("h2",{attrs:{id:"📖-学习本文"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#📖-学习本文"}},[s._v("#")]),s._v(" 📖. 学习本文")]),s._v(" "),t("p",[s._v("你将：")]),s._v(" "),t("ol",[t("li",[s._v("弄明白 rollup 输出的 6 种格式，了解它们之间的关系和使用场景。")]),s._v(" "),t("li",[s._v("获得一份最简单的 "),t("code",[s._v("rollup.js")]),s._v(" 打包 "),t("code",[s._v("demo")]),s._v(" 一份。")]),s._v(" "),t("li",[s._v("这份 "),t("code",[s._v("demo")]),s._v(" 还为每隔打包结果准备了一个可执行 "),t("code",[s._v("demo of demo")]),s._v("。")])]),s._v(" "),t("h2",{attrs:{id:"📖-为什么要学这个"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#📖-为什么要学这个"}},[s._v("#")]),s._v(" 📖. 为什么要学这个？")]),s._v(" "),t("p",[s._v("伴随着 "),t("code",[s._v("vite.js")]),s._v(" 越来越火，它也变成了工作生产和 "),t("strong",[s._v("面试问答")]),s._v(" 时被经常提及的问题。")]),s._v(" "),t("p",[s._v("众所周知，"),t("code",[s._v("vite.js")]),s._v(" 构建的核心是 "),t("code",[s._v("rollup.js")]),s._v("。")]),s._v(" "),t("p",[s._v("那为什么在学习它们之前，有必要先学习 "),t("code",[s._v("js")]),s._v(" 模块化规范？")]),s._v(" "),t("p",[s._v("因为我们需要理解它们最终的产物是什么，是如何运作的。")]),s._v(" "),t("p",[s._v("“崇拜魔法” 是编程学习者的大忌，“好奇心” 才是我们成长与进步的阶梯。")]),s._v(" "),t("p",[s._v("让我们解开神秘的面纱，看看那些打包后的代码，都是些 “什么玩意儿”！")]),s._v(" "),t("h2",{attrs:{id:"📖-demo-与-示例构建"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#📖-demo-与-示例构建"}},[s._v("#")]),s._v(" 📖. DEMO 与 示例构建")]),s._v(" "),t("blockquote",[t("p",[s._v("请配合 "),t("code",[s._v("demo")]),s._v(" 食用，你会收获更多！")])]),s._v(" "),t("p",[s._v("我为本文构建了一个简单的 "),t("code",[s._v("demo")]),s._v(" 实例，源码就放在 "),t("code",[s._v("github")]),s._v(" 上。")]),s._v(" "),t("p",[t("code",[s._v("demo")]),s._v(" 地址："),t("a",{attrs:{href:"https://github.com/oliver556/rollup-demos/tree/master/js-modules",target:"_blank",rel:"noopener noreferrer"}},[s._v("https://github.com/oliver556/rollup-demos/tree/master/js-modules"),t("OutboundLink")],1)]),s._v(" "),t("p",[t("code",[s._v("demo")]),s._v(" 的代码结构如下：")]),s._v(" "),t("div",{staticClass:"language-tree line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v("├── answer.js\n├── index.js\n├── out\n├── package.json\n├── rollup.config.js\n└── yarn.lock\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br")])]),t("p",[s._v("其中 "),t("code",[s._v("index.js")]),s._v(" 和 "),t("code",[s._v("answer.js")]),s._v(" 属于业务代码，是需要被打包的对象。在 "),t("code",[s._v("index.js")]),s._v(" 中依赖了 "),t("code",[s._v("answer.js")]),s._v("。")]),s._v(" "),t("p",[s._v("如下：")]),s._v(" "),t("div",{staticClass:"language-js line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-js"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// answer.js")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("export")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("default")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("42")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// index.js")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("import")]),s._v(" answer "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("from")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"./answer"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("import")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v(" repeat "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("from")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'lodash'")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 定义一个无用变量, 测试 tree-shaking")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("const")]),s._v(" unusedVar "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'May the 4th'")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("export")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("const")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function-variable function"}},[s._v("printAnswer")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=>")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 打印")]),s._v("\n  console"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("log")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token template-string"}},[t("span",{pre:!0,attrs:{class:"token template-punctuation string"}},[s._v("`")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("the answer is ")]),t("span",{pre:!0,attrs:{class:"token interpolation"}},[t("span",{pre:!0,attrs:{class:"token interpolation-punctuation punctuation"}},[s._v("${")]),s._v("answer"),t("span",{pre:!0,attrs:{class:"token interpolation-punctuation punctuation"}},[s._v("}")])]),t("span",{pre:!0,attrs:{class:"token template-punctuation string"}},[s._v("`")])]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 测试 lodash 的能力，打印42个1")]),s._v("\n  console"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("log")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("repeat")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'1'")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" answer"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br"),t("span",{staticClass:"line-number"},[s._v("16")]),t("br")])]),t("p",[t("code",[s._v("rollup.config.js")]),s._v(" 是 "),t("code",[s._v("rollup")]),s._v(" 的配置文件，在此文件中我们分别指定其输出 "),t("code",[s._v("amd")]),s._v(" , "),t("code",[s._v("cjs")]),s._v(" , "),t("code",[s._v("esm")]),s._v(" , "),t("code",[s._v("iife")]),s._v(" , "),t("code",[s._v("umd")]),s._v(" , "),t("code",[s._v("system")]),s._v(" 六种格式的文件。")]),s._v(" "),t("p",[s._v("输出的文件会被打包到 "),t("code",[s._v("out")]),s._v(" 文件夹下。")]),s._v(" "),t("p",[s._v("当我们执行 "),t("code",[s._v("yarn build")]),s._v(" 或者 "),t("code",[s._v("npm build")]),s._v(" 之后，会在 "),t("code",[s._v("out")]),s._v(" 下产生如下格式的代码：")]),s._v(" "),t("div",{staticClass:"language-tree line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v("├── out\n│   ├── amd\n│   │   └── bundle.js\n│   ├── cjs\n│   │   └── bundle.js\n│   ├── ems\n│   │   └── bundle.js\n│   ├── iife\n│   │   └── bundle.js\n│   ├── system\n│   │   └── bundle.js\n│   └── umd\n│       └── bundle.js\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br")])]),t("p",[s._v("为了弄清楚每种格式的 "),t("code",[s._v("bundle.js")]),s._v(" 文件是如何运作的，我专门为它们订制添加了一些附属的小 "),t("code",[s._v("demo")]),s._v("。")]),s._v(" "),t("p",[s._v("接下来，就让我们一种格式一种格式地学习和分析吧。")]),s._v(" "),t("h2",{attrs:{id:"一-iife-自执行函数"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#一-iife-自执行函数"}},[s._v("#")]),s._v(" 一. IIFE 自执行函数")]),s._v(" "),t("blockquote",[t("p",[s._v("IIFE 的全称是 “immediately invoked function expression”。")])]),s._v(" "),t("h3",{attrs:{id:"_1-打包结果分析"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_1-打包结果分析"}},[s._v("#")]),s._v(" 1. 打包结果分析")]),s._v(" "),t("p",[s._v("让我们先看看本 "),t("code",[s._v("demo")]),s._v(" 的 "),t("code",[s._v("iife")]),s._v(" 格式打出来的包长什么样。")]),s._v(" "),t("p",[t("img",{attrs:{src:"https://cdn.staticaly.com/gh/oliver556/image-hosting@master/20220718/javascript_07-18_01.6frk6lpm79k0.webp",alt:"javascript_07-18_01"}})]),s._v(" "),t("p",[s._v("对上述代码做一些简化：")]),s._v(" "),t("div",{staticClass:"language-js line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-js"}},[t("code",[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("var")]),s._v(" Test "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("function")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token parameter"}},[s._v("exports"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" lodash")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'use strict'")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 自带严格模式，避免一些奇怪的兼容性问题")]),s._v("\n\n  "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("/**\n   * 下面折行无用代码被 tree-shaking 掉了\n   * const unusedVar = 'May the 4th'\n   * */")]),s._v("\n\n  "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("var")]),s._v(" answer "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("42")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 业务中被单一引用的模块，被直接抹平了")]),s._v("\n\n  "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("const")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function-variable function"}},[s._v("printAnswer")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=>")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    console"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("log")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token template-string"}},[t("span",{pre:!0,attrs:{class:"token template-punctuation string"}},[s._v("`")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("the answer is ")]),t("span",{pre:!0,attrs:{class:"token interpolation"}},[t("span",{pre:!0,attrs:{class:"token interpolation-punctuation punctuation"}},[s._v("${")]),s._v("answer"),t("span",{pre:!0,attrs:{class:"token interpolation-punctuation punctuation"}},[s._v("}")])]),t("span",{pre:!0,attrs:{class:"token template-punctuation string"}},[s._v("`")])]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n    console"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("log")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("lodash"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("repeat")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'1'")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" answer"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n  exports"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("printAnswer "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" printAnswer"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 把要export的属性挂在到exports上")]),s._v("\n\n  "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("return")]),s._v(" exports"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" $"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// exports是第一个入参，依赖的jquery是第二个入参")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br"),t("span",{staticClass:"line-number"},[s._v("16")]),t("br"),t("span",{staticClass:"line-number"},[s._v("17")]),t("br"),t("span",{staticClass:"line-number"},[s._v("18")]),t("br"),t("span",{staticClass:"line-number"},[s._v("19")]),t("br"),t("span",{staticClass:"line-number"},[s._v("20")]),t("br"),t("span",{staticClass:"line-number"},[s._v("21")]),t("br")])]),t("p",[t("code",[s._v("IIFE")]),s._v(" 是前端模块化早期的产物，它的核心思路是:")]),s._v(" "),t("ol",[t("li",[s._v("构建一个匿名函数")]),s._v(" "),t("li",[s._v("立刻执行这个匿名函数，对外部的依赖通过入参的形式传入")]),s._v(" "),t("li",[s._v("返回该模块的输出")])]),s._v(" "),t("h3",{attrs:{id:"_2-如何运行"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_2-如何运行"}},[s._v("#")]),s._v(" 2. 如何运行")]),s._v(" "),t("p",[t("code",[s._v("IIFE")]),s._v(" 的运行其实很容易，如果它没有其他依赖，只需要去引入文件，然后在 "),t("code",[s._v("window")]),s._v(" 上取相应的变量即可。")]),s._v(" "),t("p",[s._v("如：")]),s._v(" "),t("div",{staticClass:"language-html line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-html"}},[t("code",[t("span",{pre:!0,attrs:{class:"token tag"}},[t("span",{pre:!0,attrs:{class:"token tag"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),s._v("script")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token attr-name"}},[s._v("src")]),t("span",{pre:!0,attrs:{class:"token attr-value"}},[t("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v('"')]),s._v("http://cdn.bootcss.com/jquery/3.3.1/jquery.min.js"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v('"')])]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),t("span",{pre:!0,attrs:{class:"token script"}}),t("span",{pre:!0,attrs:{class:"token tag"}},[t("span",{pre:!0,attrs:{class:"token tag"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("</")]),s._v("script")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token tag"}},[t("span",{pre:!0,attrs:{class:"token tag"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),s._v("script")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),t("span",{pre:!0,attrs:{class:"token script"}},[t("span",{pre:!0,attrs:{class:"token language-javascript"}},[s._v(" \n  "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// jquery 就是典型的自执行函数模式，当你引入后，他就会挂在到 window.$ 上")]),s._v("\n  window"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("$ "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 这样就能取到 jquery 了")]),s._v("\n")])]),t("span",{pre:!0,attrs:{class:"token tag"}},[t("span",{pre:!0,attrs:{class:"token tag"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("</")]),s._v("script")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br")])]),t("p",[s._v("但是如果你像本 "),t("code",[s._v("demo")]),s._v(" 中那样依赖了其他的模块，那你就必须保证以下两点才能正常运行：")]),s._v(" "),t("ol",[t("li",[s._v("此包所依赖的包，已在此包之前完成加载。")]),s._v(" "),t("li",[s._v("前置依赖的包，和 "),t("code",[s._v("IIFE")]),s._v(" 只执行入参的变量命名是一致的。")])]),s._v(" "),t("p",[s._v("以本 "),t("code",[s._v("demo")]),s._v(" 的 "),t("code",[s._v("IIFE")]),s._v(" 构建结果为例：")]),s._v(" "),t("ol",[t("li",[s._v("它前置依赖了 "),t("code",[s._v("lodash")]),s._v("，因此需要在它加载之前完成 lodash 的加载。")]),s._v(" "),t("li",[s._v("此 "),t("code",[s._v("IIFE")]),s._v(" 的第二个入参是 "),t("code",[s._v("lodash")]),s._v("，作为前置条件，我们需要让 "),t("code",[s._v("window.lodash")]),s._v(" 也指向 "),t("code",[s._v("lodash")]),s._v("。 因此，运行时，代码如下：")])]),s._v(" "),t("div",{staticClass:"language-html line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-html"}},[t("code",[t("span",{pre:!0,attrs:{class:"token tag"}},[t("span",{pre:!0,attrs:{class:"token tag"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),s._v("head")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token tag"}},[t("span",{pre:!0,attrs:{class:"token tag"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),s._v("script")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token attr-name"}},[s._v("src")]),t("span",{pre:!0,attrs:{class:"token attr-value"}},[t("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v('"')]),s._v("https://cdn.bootcdn.net/ajax/libs/lodash.js/4.17.21/lodash.min.js"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v('"')])]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),t("span",{pre:!0,attrs:{class:"token script"}}),t("span",{pre:!0,attrs:{class:"token tag"}},[t("span",{pre:!0,attrs:{class:"token tag"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("</")]),s._v("script")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token tag"}},[t("span",{pre:!0,attrs:{class:"token tag"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),s._v("script")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),t("span",{pre:!0,attrs:{class:"token script"}},[t("span",{pre:!0,attrs:{class:"token language-javascript"}},[s._v("window"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("lodash "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" window"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("_")])]),t("span",{pre:!0,attrs:{class:"token tag"}},[t("span",{pre:!0,attrs:{class:"token tag"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("</")]),s._v("script")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("  \n  "),t("span",{pre:!0,attrs:{class:"token tag"}},[t("span",{pre:!0,attrs:{class:"token tag"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),s._v("script")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token attr-name"}},[s._v("src")]),t("span",{pre:!0,attrs:{class:"token attr-value"}},[t("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v('"')]),s._v("./bundle.js"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v('"')])]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),t("span",{pre:!0,attrs:{class:"token script"}}),t("span",{pre:!0,attrs:{class:"token tag"}},[t("span",{pre:!0,attrs:{class:"token tag"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("</")]),s._v("script")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token tag"}},[t("span",{pre:!0,attrs:{class:"token tag"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("</")]),s._v("head")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token tag"}},[t("span",{pre:!0,attrs:{class:"token tag"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),s._v("body")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token tag"}},[t("span",{pre:!0,attrs:{class:"token tag"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),s._v("script")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),t("span",{pre:!0,attrs:{class:"token script"}},[t("span",{pre:!0,attrs:{class:"token language-javascript"}},[s._v("\n    window"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("Test"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("printAnswer")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n  ")])]),t("span",{pre:!0,attrs:{class:"token tag"}},[t("span",{pre:!0,attrs:{class:"token tag"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("</")]),s._v("script")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token tag"}},[t("span",{pre:!0,attrs:{class:"token tag"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("</")]),s._v("body")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br")])]),t("h3",{attrs:{id:"_3-优缺点"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_3-优缺点"}},[s._v("#")]),s._v(" 3. 优缺点")]),s._v(" "),t("ul",[t("li",[s._v("优点:\n"),t("ul",[t("li",[s._v("通过闭包营造了一个“私有”命名空间，防止影响全局，并防止被从外部修改私有变量。")]),s._v(" "),t("li",[s._v("简单易懂")]),s._v(" "),t("li",[s._v("对代码体积的影响不大")])])]),s._v(" "),t("li",[s._v("缺点：\n"),t("ul",[t("li",[s._v("输出的变量可能影响全局变量；引入依赖包时依赖全局变量。")]),s._v(" "),t("li",[s._v("需要使用者自行维护 script 标签的加载顺序。")])])])]),s._v(" "),t("p",[s._v("优点就不细说了，缺点详细解释一下。")]),s._v(" "),t("p",[t("strong",[s._v("缺点一：输出的变量可能影响全局变量；引入依赖包时依赖全局变量。")])]),s._v(" "),t("p",[s._v("前半句："),t("strong",[s._v("输出的变量可能影响全局变量;")]),s._v(" 其实很好理解，以上面 "),t("code",[s._v("demo")]),s._v(" 的输出为例： "),t("code",[s._v("window.Test")]),s._v(" 就已经被影响了。这种明显的副作用在程序中其实是有隐患的。")]),s._v(" "),t("p",[s._v("后半句："),t("strong",[s._v("引入依赖包时依赖全局变量；")]),s._v(" 我们为了让 "),t("code",[s._v("demo")]),s._v(" 正常运行，因此加了一行代码让 "),t("code",[s._v("window.lodash")]),s._v(" 也指向 "),t("code",[s._v("lodash")]),s._v("，但它确实是太脆弱了。")]),s._v(" "),t("div",{staticClass:"language-html line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-html"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("\x3c!-- 没有这一行，demo就无法正常运行 --\x3e")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token tag"}},[t("span",{pre:!0,attrs:{class:"token tag"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),s._v("script")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),t("span",{pre:!0,attrs:{class:"token script"}},[t("span",{pre:!0,attrs:{class:"token language-javascript"}},[s._v("window"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("lodash "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" window"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("_")])]),t("span",{pre:!0,attrs:{class:"token tag"}},[t("span",{pre:!0,attrs:{class:"token tag"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("</")]),s._v("script")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br")])]),t("p",[s._v("你瞧，"),t("code",[s._v("IIFE")]),s._v(" 的执行对环境的依赖是苛刻的，除非它完全不依赖外部包。（Jquery: 正是在下！）")]),s._v(" "),t("p",[s._v("虽然 "),t("code",[s._v("IIFE")]),s._v(" 的缺点很多，但并不妨碍它在 "),t("code",[s._v("Jquery")]),s._v(" 时代极大地推动了 "),t("code",[s._v("web")]),s._v(" 开发的进程，因为它确实解决了 "),t("code",[s._v("js")]),s._v(" 本身存在的很多问题。")]),s._v(" "),t("p",[s._v("那么？后续是否还有 "),t("strong",[s._v("更为优秀")]),s._v(" 的前端模块化方案问世呢？")]),s._v(" "),t("p",[s._v("当然有，往下看吧。")]),s._v(" "),t("h2",{attrs:{id:"二-commonjs"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#二-commonjs"}},[s._v("#")]),s._v(" 二. CommonJS")]),s._v(" "),t("h3",{attrs:{id:"_1-分析打包结果"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_1-分析打包结果"}},[s._v("#")]),s._v(" 1. 分析打包结果")]),s._v(" "),t("p",[s._v("先看看 "),t("code",[s._v("CommonJs")]),s._v(" 打包的结果:")]),s._v(" "),t("p",[t("img",{attrs:{src:"https://cdn.staticaly.com/gh/oliver556/image-hosting@master/20220718/javascript_07-18_02.36xdievzk260.webp",alt:"javascript_07-18_02"}})]),s._v(" "),t("p",[s._v("简化一下，就长这样了：")]),s._v(" "),t("div",{staticClass:"language-js line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-js"}},[t("code",[t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'use strict'")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("var")]),s._v(" lodash "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("require")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'lodash'")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("var")]),s._v(" answer "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("42")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("const")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function-variable function"}},[s._v("printAnswer")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=>")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 打印")]),s._v("\n  console"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("log")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token template-string"}},[t("span",{pre:!0,attrs:{class:"token template-punctuation string"}},[s._v("`")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("the answer is ")]),t("span",{pre:!0,attrs:{class:"token interpolation"}},[t("span",{pre:!0,attrs:{class:"token interpolation-punctuation punctuation"}},[s._v("${")]),s._v("answer"),t("span",{pre:!0,attrs:{class:"token interpolation-punctuation punctuation"}},[s._v("}")])]),t("span",{pre:!0,attrs:{class:"token template-punctuation string"}},[s._v("`")])]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 测试 lodash 的能力，打印42个1")]),s._v("\n  console"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("log")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("lodash"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("repeat")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'1'")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" answer"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\nexports"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("printAnswer "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" printAnswer"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br")])]),t("p",[s._v("以上格式，就是 "),t("code",[s._v("CommonJS")]),s._v(" 规范的写法。")]),s._v(" "),t("div",{staticClass:"language-js line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-js"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// CommonJS 通过一个全局 require 方法进行模块的引入 ")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("var")]),s._v(" lodash "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("require")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'lodash'")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// CommonJS 进行模块内方法输出的方式")]),s._v("\nmodule"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("exports"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("printAnswer "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" printAnswer"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 上面写法也等价于：")]),s._v("\nexports"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("printAnswer "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" printAnswer"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 因为 exports 变量等价于 module.exports")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br")])]),t("p",[s._v("为了解决 "),t("code",[s._v("node.js")]),s._v(" 在模块化上的缺失， "),t("strong",[s._v("2009年10月")]),s._v(" "),t("code",[s._v("CommonJS")]),s._v(" 规范首次被提出。")]),s._v(" "),t("p",[s._v("注意这个关键词： "),t("strong",[s._v("node.js")]),s._v("。")]),s._v(" "),t("p",[s._v("是的，"),t("code",[s._v("CommonJS")]),s._v(" 并不是在浏览器环境运行的规范，而是在 "),t("code",[s._v("node.js")]),s._v(" 环境下运行的。")]),s._v(" "),t("h3",{attrs:{id:"_2-如何运行-2"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_2-如何运行-2"}},[s._v("#")]),s._v(" 2. 如何运行")]),s._v(" "),t("p",[s._v("因此，我写了一个 "),t("code",[s._v("run.js")]),s._v(" 脚本。 如下：")]),s._v(" "),t("div",{staticClass:"language-js line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-js"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// run.js")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("const")]),s._v(" Test "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("require")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'./bundle-by-lodash'")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\nTest"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("printAnswer")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br")])]),t("p",[s._v("然后，执行以下命令：")]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 执行脚本")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("node")]),s._v(" ./out/cjs/run.js \n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 输出1： ")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" the answer is "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("42")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 输出2： ")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("111111111111111111111111111111111111111111")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br")])]),t("p",[s._v("可以看出，"),t("code",[s._v("node.js")]),s._v(" 环境是天然支持 "),t("code",[s._v("CommonJS")]),s._v(" 的。")]),s._v(" "),t("p",[s._v("##3 3. 优缺点")]),s._v(" "),t("ul",[t("li",[s._v("优点\n"),t("ol",[t("li",[s._v("完善的模块化方案，完美解决了 IIFE 的各种缺点。")])])]),s._v(" "),t("li",[s._v("缺点\n"),t("ol",[t("li",[s._v("不支持浏览器环境，因为这种同步的引入方式可能导致浏览器假死。")])])])]),s._v(" "),t("p",[s._v("因此，前端界迫切地需要一种能在浏览器环境完美运行，完善的模块化方案。")]),s._v(" "),t("h2",{attrs:{id:"三-amd-和-requirejs"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#三-amd-和-requirejs"}},[s._v("#")]),s._v(" 三. AMD 和 requirejs !")]),s._v(" "),t("blockquote",[t("p",[s._v("AMD，YES!")])]),s._v(" "),t("p",[s._v("2011年， "),t("code",[s._v("amdjs-api")]),s._v(" 在业内被正式提出。")]),s._v(" "),t("h3",{attrs:{id:"_1-打包结果分析-2"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_1-打包结果分析-2"}},[s._v("#")]),s._v(" 1. 打包结果分析")]),s._v(" "),t("p",[s._v("amd 格式的打包结果如下：")]),s._v(" "),t("p",[t("img",{attrs:{src:"https://cdn.staticaly.com/gh/oliver556/image-hosting@master/20220718/javascript_07-18_03.6c8fyxl59k80.webp",alt:"javascript_07-18_03"}})]),s._v(" "),t("p",[s._v("可以看到，核心内容是一个全局方法 "),t("code",[s._v("define")]),s._v(" 。")]),s._v(" "),t("p",[t("code",[s._v("define")]),s._v(" 方法有三个入参，分别是：")]),s._v(" "),t("ul",[t("li",[t("code",[s._v('"Test"')]),s._v(", 模块名称")]),s._v(" "),t("li",[t("code",[s._v("[")]),s._v("exports"),t("code",[s._v(",")]),s._v(" lodash"),t("code",[s._v("]")]),s._v(" 分别表示模块的输出和外部依赖")]),s._v(" "),t("li",[s._v("一个以 "),t("code",[s._v("exports")]),s._v(" 和 "),t("code",[s._v("lodash")]),s._v(" 作为入参的方法，代表模块的实际内容。")])]),s._v(" "),t("p",[s._v("相比于 "),t("code",[s._v("IIFE")]),s._v(" 和 "),t("code",[s._v("CommonJs")]),s._v(" 而言，"),t("code",[s._v("AMD")]),s._v(" 的写法无疑是复杂且别扭的。")]),s._v(" "),t("p",[s._v("但它却实实在在是解决了 "),t("code",[s._v("IIFE 和")]),s._v(" "),t("code",[s._v("CommonJS")]),s._v(" 所面临的问题，对“浏览器里完善的 JS 模块方法” 提供了一套完善的方案。")]),s._v(" "),t("p",[s._v("尤其是 "),t("code",[s._v("amd")]),s._v(" 标准的实现方案："),t("code",[s._v("requirejs")]),s._v("。")]),s._v(" "),t("p",[t("code",[s._v("requirejs")]),s._v(" 所实现的 "),t("code",[s._v("AMD")]),s._v(" 不仅解决了 "),t("code",[s._v("CommonJS")]),s._v(" 在浏览器端的不适，通过异步的方式进行模块加载实现了不会导致假死的能力；更是完全弥补了 "),t("code",[s._v("IIFE")]),s._v(" 存在的各类缺陷。")]),s._v(" "),t("p",[t("code",[s._v("requirejs")]),s._v(" 在使用时，一般情况下是以下四步法：")]),s._v(" "),t("ol",[t("li",[s._v("在浏览器内引入 "),t("code",[s._v("require.js")])]),s._v(" "),t("li",[s._v("通过 "),t("code",[s._v("requirejs.config")]),s._v(" 方法定义全局的依赖")]),s._v(" "),t("li",[s._v("通过 "),t("code",[s._v("requirejs.define")]),s._v(" 注册模块")]),s._v(" "),t("li",[s._v("通过 "),t("code",[s._v("requirejs()")]),s._v(" 完成模块引入。")])]),s._v(" "),t("h3",{attrs:{id:"_2-如何运行-3"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_2-如何运行-3"}},[s._v("#")]),s._v(" 2. 如何运行")]),s._v(" "),t("p",[s._v("在 "),t("code",[s._v("out/amd")]),s._v(" 打包目录下的 "),t("code",[s._v("index.html")]),s._v(" 里，按如下方式编排代码：")]),s._v(" "),t("div",{staticClass:"language-html line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-html"}},[t("code",[t("span",{pre:!0,attrs:{class:"token tag"}},[t("span",{pre:!0,attrs:{class:"token tag"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),s._v("head")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("\x3c!-- 1. 引入 require.js --\x3e")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token tag"}},[t("span",{pre:!0,attrs:{class:"token tag"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),s._v("script")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token attr-name"}},[s._v("src")]),t("span",{pre:!0,attrs:{class:"token attr-value"}},[t("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v('"')]),s._v("./require.js"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v('"')])]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),t("span",{pre:!0,attrs:{class:"token script"}}),t("span",{pre:!0,attrs:{class:"token tag"}},[t("span",{pre:!0,attrs:{class:"token tag"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("</")]),s._v("script")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("\n\n  "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("\x3c!-- 2. 定义全局依赖 --\x3e")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token tag"}},[t("span",{pre:!0,attrs:{class:"token tag"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),s._v("script")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),t("span",{pre:!0,attrs:{class:"token script"}},[t("span",{pre:!0,attrs:{class:"token language-javascript"}},[s._v("\n    window"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("requirejs"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("config")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n      "),t("span",{pre:!0,attrs:{class:"token literal-property property"}},[s._v("paths")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token string-property property"}},[s._v('"lodash"')]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"https://cdn.bootcdn.net/ajax/libs/lodash.js/4.17.21/lodash.min"')]),s._v("\n      "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n  ")])]),t("span",{pre:!0,attrs:{class:"token tag"}},[t("span",{pre:!0,attrs:{class:"token tag"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("</")]),s._v("script")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("\n\n  "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("\x3c!-- 3. 定义模块 --\x3e")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token tag"}},[t("span",{pre:!0,attrs:{class:"token tag"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),s._v("script")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token attr-name"}},[s._v("src")]),t("span",{pre:!0,attrs:{class:"token attr-value"}},[t("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v('"')]),s._v("./bundle.js"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v('"')])]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),t("span",{pre:!0,attrs:{class:"token script"}}),t("span",{pre:!0,attrs:{class:"token tag"}},[t("span",{pre:!0,attrs:{class:"token tag"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("</")]),s._v("script")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token tag"}},[t("span",{pre:!0,attrs:{class:"token tag"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("</")]),s._v("head")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token tag"}},[t("span",{pre:!0,attrs:{class:"token tag"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),s._v("body")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token tag"}},[t("span",{pre:!0,attrs:{class:"token tag"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),s._v("script")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),t("span",{pre:!0,attrs:{class:"token script"}},[t("span",{pre:!0,attrs:{class:"token language-javascript"}},[s._v("\n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 4. 开销模块")]),s._v("\n    window"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("requirejs")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("\n      "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'Test'")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n      "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("function")]),s._v("   "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token parameter"}},[s._v("test")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        test"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("printAnswer")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n      "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n  ")])]),t("span",{pre:!0,attrs:{class:"token tag"}},[t("span",{pre:!0,attrs:{class:"token tag"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("</")]),s._v("script")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token tag"}},[t("span",{pre:!0,attrs:{class:"token tag"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("</")]),s._v("body")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br"),t("span",{staticClass:"line-number"},[s._v("16")]),t("br"),t("span",{staticClass:"line-number"},[s._v("17")]),t("br"),t("span",{staticClass:"line-number"},[s._v("18")]),t("br"),t("span",{staticClass:"line-number"},[s._v("19")]),t("br"),t("span",{staticClass:"line-number"},[s._v("20")]),t("br"),t("span",{staticClass:"line-number"},[s._v("21")]),t("br"),t("span",{staticClass:"line-number"},[s._v("22")]),t("br"),t("span",{staticClass:"line-number"},[s._v("23")]),t("br"),t("span",{staticClass:"line-number"},[s._v("24")]),t("br"),t("span",{staticClass:"line-number"},[s._v("25")]),t("br"),t("span",{staticClass:"line-number"},[s._v("26")]),t("br"),t("span",{staticClass:"line-number"},[s._v("27")]),t("br")])]),t("p",[s._v("打开浏览器，我们可以正常地看到]控制台里被打印出来的 "),t("code",[s._v("42")]),s._v(" 和 "),t("code",[s._v("42个1")]),s._v(" 了。")]),s._v(" "),t("h3",{attrs:{id:"_3-优缺点-2"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_3-优缺点-2"}},[s._v("#")]),s._v(" 3. 优缺点")]),s._v(" "),t("ul",[t("li",[s._v("优点\n"),t("ol",[t("li",[s._v("解决了 "),t("code",[s._v("CommonJS")]),s._v(" 的缺点")]),s._v(" "),t("li",[s._v("解决了 "),t("code",[s._v("IIFE")]),s._v(" 的缺点")]),s._v(" "),t("li",[s._v("一套完备的浏览器里 "),t("code",[s._v("js")]),s._v(" 文件模块化方案")])])]),s._v(" "),t("li",[s._v("缺点\n"),t("ol",[t("li",[s._v("代码组织形式别扭，可读性差")])])])]),s._v(" "),t("p",[s._v("但好在我们拥有了各类打包工具，浏览器内的代码可读性再差也并不影响我们写出可读性ok的代码。")]),s._v(" "),t("p",[s._v("现在，我们拥有了"),t("strong",[s._v("面向 "),t("code",[s._v("node.js")]),s._v(" 的 "),t("code",[s._v("CommonJs")])]),s._v(" 和 "),t("strong",[s._v("面向浏览器的 "),t("code",[s._v("AMD")])]),s._v(" 两套标准。")]),s._v(" "),t("p",[s._v("如果我希望我写出的代码能同时被 "),t("strong",[s._v("浏览器")]),s._v(" 和 "),t("strong",[s._v("nodejs")]),s._v(" 识别，我应该怎么做呢？")]),s._v(" "),t("h2",{attrs:{id:"四-umd-伟大的整合"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#四-umd-伟大的整合"}},[s._v("#")]),s._v(" 四. UMD 伟大的整合")]),s._v(" "),t("blockquote",[t("p",[s._v("它没有做什么突破性的创造，但它是集大成者。")])]),s._v(" "),t("h3",{attrs:{id:"_1-打包分析"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_1-打包分析"}},[s._v("#")]),s._v(" 1. 打包分析")]),s._v(" "),t("p",[t("code",[s._v("umd")]),s._v(" 格式构建出来的代码的可读性进一步降低了。")]),s._v(" "),t("p",[s._v("我相信任何正常人看到下面这段代码都会感到一阵头大：")]),s._v(" "),t("p",[t("img",{attrs:{src:"https://cdn.staticaly.com/gh/oliver556/image-hosting@master/20220718/javascript_07-18_04.263jdfxpn30.webp",alt:"javascript_07-18_04"}})]),s._v(" "),t("p",[s._v("是的，整整一大段代码，只是在处理兼容性问题，判断当前应该使用 "),t("code",[s._v("amd")]),s._v(" 亦或是 "),t("code",[s._v("CommonJS")]),s._v("。")]),s._v(" "),t("p",[s._v("因此 umd 的代码和实现不在此进行过多分析，它所做的无非便是让同一段代码兼容了 "),t("code",[s._v("amd")]),s._v(" 和 "),t("code",[s._v("CommonJS")]),s._v("。")]),s._v(" "),t("h3",{attrs:{id:"_2-如何运行-4"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_2-如何运行-4"}},[s._v("#")]),s._v(" 2. 如何运行？")]),s._v(" "),t("ul",[t("li",[s._v("在浏览器端，它的运行方式和 "),t("code",[s._v("amd")]),s._v(" 完全一致，可以完全参考 "),t("code",[s._v("3.2")]),s._v(" 节的 "),t("code",[s._v("demo")]),s._v("。")]),s._v(" "),t("li",[s._v("在 node.js 端，它则和 "),t("code",[s._v("CommonJS")]),s._v(" 的运行方式完全一致，在此就不赘述了。")])]),s._v(" "),t("h3",{attrs:{id:"_3-优缺点-3"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_3-优缺点-3"}},[s._v("#")]),s._v(" 3. 优缺点")]),s._v(" "),t("ul",[t("li",[s._v("优点\n"),t("ul",[t("li",[s._v("抹平了一个包在 AMD 和 CommonJS 里的差异")])])]),s._v(" "),t("li",[s._v("缺点\n"),t("ul",[t("li",[s._v("会为了兼容产生大量不好理解的代码。（理解难度与包体积）")])])])]),s._v(" "),t("p",[s._v("虽然在社区的不断努力下，"),t("code",[s._v("CommonJS")]),s._v(" 、 "),t("code",[s._v("AMD")]),s._v(" 、 "),t("code",[s._v("UMD")]),s._v(" 都给业界交出了自己的答卷。")]),s._v(" "),t("p",[s._v("但很显然，它们都是不得已的选择。")]),s._v(" "),t("p",[s._v("浏览器应该有自己的加载标准。")]),s._v(" "),t("p",[t("code",[s._v("ES6")]),s._v(" 草案最终版里，虽然描述了模块应该如何被加载，但它没有 “加载程序的规范”。")]),s._v(" "),t("h2",{attrs:{id:"五-systemjs"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#五-systemjs"}},[s._v("#")]),s._v(" 五. SystemJs")]),s._v(" "),t("p",[s._v("因此 "),t("code",[s._v("WHATWG（Web Hypertext Application Technology Working Group）")]),s._v(" 即网页超文本应用技术工作小组，提出了一套更有远见的规范："),t("a",{attrs:{href:"https://github.com/whatwg/loader",target:"_blank",rel:"noopener noreferrer"}},[s._v("whatwg/loader"),t("OutboundLink")],1),s._v("。")]),s._v(" "),t("p",[s._v("也就是 "),t("code",[s._v("JavaScript Loader Standard")]),s._v("（JS 加载标准）。")]),s._v(" "),t("blockquote",[t("p",[s._v("本规范描述了从 JavaScript 宿主环境中加载 JavaScript 模块的行为。它还提供了用于拦截模块加载过程和自定义加载行为的 api。")])]),s._v(" "),t("p",[s._v("基于此规范，"),t("code",[s._v("SystemJS")]),s._v(" 诞生了。")]),s._v(" "),t("p",[t("code",[s._v("SystemJS")]),s._v(" 是目前 "),t("code",[s._v("whatwg/loader")]),s._v(" 规范的最佳实践者。")]),s._v(" "),t("p",[t("img",{attrs:{src:"https://cdn.staticaly.com/gh/oliver556/image-hosting@master/20220718/javascript_07-18_05.5z2xhkkomew0.webp",alt:"javascript_07-18_05"}})]),s._v(" "),t("p",[s._v("可以看出来，"),t("code",[s._v("system")]),s._v(" 的打包结果其实和 "),t("code",[s._v("amd")]),s._v(" 类似，提供了全局的对象 "),t("code",[s._v("System")]),s._v("，并提供了注册的方式和统一的写法。")]),s._v(" "),t("p",[s._v("就单纯的从打包结果上，其实看不出它相比对 "),t("code",[s._v("AMD + require.js")]),s._v(" 有什么优势，"),t("strong",[s._v("难道只是写法上存在差异?")])]),s._v(" "),t("p",[s._v("并不止于此！")]),s._v(" "),t("p",[s._v("相比于 "),t("code",[s._v("require.js")]),s._v("，"),t("code",[s._v("SystemJS")]),s._v(" 的 "),t("code",[s._v("System.import('module/name')")]),s._v(" 方式允许你更为 “懒” 地加载模块，这意味着你无需每次都加载一大堆的 "),t("code",[s._v("bundle")]),s._v("，用户只需要为他能看见的页面开销带宽。")]),s._v(" "),t("p",[s._v("另外，正因为 "),t("code",[s._v("SystemJS")]),s._v(" 是面向 "),t("code",[s._v("whatwg/loader")]),s._v(" 规范实践的，因此它是面向未来的模块依赖方式。")]),s._v(" "),t("blockquote",[t("p",[s._v("抱歉，这个的 demo 我也没玩明白，就不误导大家了。希望有明白的大佬可以帮忙完善下demo。")])]),s._v(" "),t("h2",{attrs:{id:"六-esm"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#六-esm"}},[s._v("#")]),s._v(" 六. ESM")]),s._v(" "),t("blockquote",[t("p",[s._v("ECMAScript modules, 也叫 ESM, Javascript 模块化官方标准格式。")])]),s._v(" "),t("h3",{attrs:{id:"_1-打包分析-2"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_1-打包分析-2"}},[s._v("#")]),s._v(" 1. 打包分析")]),s._v(" "),t("p",[s._v("在 "),t("code",[s._v("ESM")]),s._v(" 被提出来之前，JavaScript 一直没有真正意义上的模块（module）体系。")]),s._v(" "),t("p",[s._v("它的规范是通过 "),t("code",[s._v("export")]),s._v(" 命令显式指定输出的代码，再通过 "),t("code",[s._v("import")]),s._v(" 命令输入。")]),s._v(" "),t("div",{staticClass:"language-js line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-js"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 导入模块")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("import")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v(" foo "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("from")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'bar'")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 导出命令")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("export")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v(" zap "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br")])]),t("p",[s._v("这也是我们日常开发中最为熟悉的写法。")]),s._v(" "),t("p",[s._v("因此，"),t("code",[s._v("esm")]),s._v(" 格式打出来的包，可读性确实非常棒:")]),s._v(" "),t("p",[t("img",{attrs:{src:"https://cdn.staticaly.com/gh/oliver556/image-hosting@master/20220718/javascript_07-18_06.3cratjoe2t00.webp",alt:"javascript_07-18_06"}})]),s._v(" "),t("p",[s._v("和阅读我们平时所写的业务代码完全没有区别。（"),t("code",[s._v("rollup")]),s._v(" 依然没忘记做 "),t("code",[s._v("tree-shaking")]),s._v("）")]),s._v(" "),t("h3",{attrs:{id:"_2-如何运行-5"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_2-如何运行-5"}},[s._v("#")]),s._v(" 2. 如何运行")]),s._v(" "),t("blockquote",[t("p",[s._v("祝贺你，是这个时代的前端开发。")])]),s._v(" "),t("p",[s._v("部分现代浏览器已经开始实装 "),t("code",[s._v('<script type="module>')]),s._v(" 了，因此在浏览器上直接使用 "),t("code",[s._v("esm")]),s._v(" 已成为现实。")]),s._v(" "),t("p",[s._v("但运行起来扔需要做一些前置步骤。")]),s._v(" "),t("ol",[t("li",[s._v("在 js-modules 目录下起一个本地静态服务")])]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 在js-modules目录下起一个本地静态服务")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("cd")]),s._v(" js-modules "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("&&")]),s._v(" http-server\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br")])]),t("ol",{attrs:{start:"2"}},[t("li",[s._v("把 "),t("code",[s._v("esm/bundle.js")]),s._v(" 文件的第一行修改为：")])]),s._v(" "),t("div",{staticClass:"language-js line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-js"}},[t("code",[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("import")]),s._v(" repeat "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("from")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'../../node_modules/lodash-es/repeat.js'")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 因为默认的lodash并不是输出的 esm 格式，因此为了demo我们需要做一些特殊处理")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br")])]),t("ol",{attrs:{start:"3"}},[t("li",[s._v("在浏览器打开页面(假设端口是8080)，则打开："),t("a",{attrs:{href:"http://127.0.0.1:8080/out/esm/index.html",target:"_blank",rel:"noopener noreferrer"}},[s._v("http://127.0.0.1:8080/out/esm/index.html"),t("OutboundLink")],1)])]),s._v(" "),t("p",[s._v("这样一来，代码就能成功运行，控制台就可以成功打印 "),t("code",[s._v("42")]),s._v(" 和 "),t("code",[s._v("42个1")]),s._v(" 了。")]),s._v(" "),t("h2",{attrs:{id:"🌟-总结"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#🌟-总结"}},[s._v("#")]),s._v(" 🌟. 总结")]),s._v(" "),t("p",[t("strong",[s._v("分别适合在什么场景使用？")])]),s._v(" "),t("ul",[t("li",[t("code",[s._v("IIFE")]),s._v(": 适合部分场景作为SDK进行使用，尤其是需要把自己挂到 "),t("code",[s._v("window")]),s._v(" 上的场景。")]),s._v(" "),t("li",[t("code",[s._v("CommonJS")]),s._v(": 仅 node.js 使用的库。")]),s._v(" "),t("li",[t("code",[s._v("AMD")]),s._v(": 只需要在浏览器端使用的场景。")]),s._v(" "),t("li",[t("code",[s._v("UMD")]),s._v(": 既可能在浏览器端也可能在 node.js 里使用的场景。")]),s._v(" "),t("li",[t("code",[s._v("SystemJs")]),s._v(": 和 UMD 类似。目前较出名的 "),t("code",[s._v("Angular")]),s._v(" 用的就是它。")]),s._v(" "),t("li",[t("code",[s._v("ESM")]),s._v(":\n"),t("ol",[t("li",[s._v("还会被引用、二次编译的场景（如组件库等）；")]),s._v(" "),t("li",[s._v("浏览器调试场景如 "),t("code",[s._v("vite.js")]),s._v(" 的开发时。")]),s._v(" "),t("li",[s._v("对浏览器兼容性非常宽松的场景。")])])])])])}),[],!1,null,null,null);t.default=e.exports}}]);